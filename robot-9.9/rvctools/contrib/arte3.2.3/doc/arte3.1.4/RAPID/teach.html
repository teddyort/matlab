<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of teach</title>
  <meta name="keywords" content="teach">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">arte3.1.4</a> &gt; <a href="index.html">RAPID</a> &gt; teach.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for arte3.1.4/RAPID&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>teach
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = teach(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">
 TEACH MATLAB code for teach.fig
      TEACH, by itself, creates a new TEACH or raises the existing
      singleton*.

      H = TEACH returns the handle to a new TEACH or the handle to
      the existing singleton*.

      TEACH('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in TEACH.M with the given input arguments.

      TEACH('Property','Value',...) creates a new TEACH or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before teach_OpeningFcn gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to teach_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one
      instance to run (singleton)&quot;.

 See also: GUIDE, GUIDATA, GUIHANDLES</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li><li><a href="../../arte3.1.4/RAPID/functions/select_closest_joint_coordinates.html" class="code" title="function q=select_closest_joint_coordinates(robot, qinv, q_current)">select_closest_joint_coordinates</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li><li><a href="../../arte3.1.4/RAPID/functions/select_configuration.html" class="code" title="function q=select_configuration(robot, qinv, conf)">select_configuration</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li><li><a href="../../arte3.1.4/RAPID/functions/test_joint_limits.html" class="code" title="function [joint, time] = test_joint_limits(robot)">test_joint_limits</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li><li><a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li><li><a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>	DIRECTKINEMATIC		Direct Kinematic for serial robots.</li><li><a href="../../arte3.1.4/lib/kinematics/inversekinematic.html" class="code" title="function q = inversekinematic(robot, T)">inversekinematic</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li><li><a href="../../arte3.1.4/lib/quaternion2T.html" class="code" title="function T = quaternion2T(Q, P)">quaternion2T</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li><li><a href="../../arte3.1.4/lib/test_joints.html" class="code" title="function error=test_joints(robot, q)">test_joints</a>	Test whether any of the joint angles exceeds the mechanical</li><li><a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li><li><a href="../../arte3.1.4/tools/vect_arrow.html" class="code" title="function vect_arrow(p0, p1, color, width)">vect_arrow</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../arte3.1.4/demos/demos.html" class="code" title="">demos</a>	Copyright (C) 2012, by Arturo Gil Aparicio</li><li><a href="../../arte3.1.4/demos/manufacturing_demo.html" class="code" title="">manufacturing_demo</a>	SCRIPT TO TEST THE GRAPHIC CAPABILITIES OF THE TOOLBOX: ROBOT IN A MANUFACTURING CELL</li><li><a href="../../arte3.1.4/demos/spot_welding_demo.html" class="code" title="">spot_welding_demo</a>	SCRIPT TO TEST THE GRAPHIC CAPABILITIES OF THE TOOLBOX: ROBOT IN A MANUFACTURING CELL</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function teach_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = teach_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function popupmenu_instruction_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function popupmenu_instruction_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function listbox1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function listbox1_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function popupmenu_target_point_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function popupmenu_target_point_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function popupmenu_through_point_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function popupmenu_through_point_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function popupmenu_speed_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function popupmenu_speed_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function pushbutton1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function popupmenu_precision_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function popupmenu_precision_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function slider_q1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function slider_q1_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub18" class="code">function slider_q2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function slider_q2_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function slider_q3_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function slider_q3_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function slider_q4_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function slider_q4_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function slider_q5_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub25" class="code">function slider_q5_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function slider_q6_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub27" class="code">function slider_q6_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub28" class="code">function pushbutton_x_minus_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub29" class="code">function pushbutton_x_plus_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub30" class="code">function pushbutton_y_plus_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub31" class="code">function pushbutton_y_minus_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub32" class="code">function pushbutton_z_plus_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub33" class="code">function pushbutton_z_minus_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub34" class="code">function edit_q1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub35" class="code">function edit_q1_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub36" class="code">function edit_q2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub37" class="code">function edit_q2_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub38" class="code">function edit_q3_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub39" class="code">function edit_q3_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub40" class="code">function edit_q4_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub41" class="code">function edit_q4_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub42" class="code">function edit_q5_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub43" class="code">function edit_q5_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub44" class="code">function edit_q6_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub45" class="code">function edit_q6_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub46" class="code">function pushbutton_load_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub47" class="code">function pushbutton_save_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub48" class="code">function pushbutton_simulate_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub49" class="code">function edit_nx_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub50" class="code">function edit_nx_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub51" class="code">function edit_ox_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub52" class="code">function edit_ox_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub53" class="code">function edit_ax_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub54" class="code">function edit_ax_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub55" class="code">function edit_pxt_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub56" class="code">function edit_pxt_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub57" class="code">function edit_ny_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub58" class="code">function edit_ny_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub59" class="code">function edit_oy_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub60" class="code">function edit_oy_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub61" class="code">function edit_ay_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub62" class="code">function edit_ay_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub63" class="code">function edit_pyt_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub64" class="code">function edit_pyt_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub65" class="code">function edit_nz_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub66" class="code">function edit_nz_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub67" class="code">function edit_oz_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub68" class="code">function edit_oz_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub69" class="code">function edit_az_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub70" class="code">function edit_az_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub71" class="code">function edit_pzt_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub72" class="code">function edit_pzt_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub73" class="code">function pushbutton_moveT_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub74" class="code">function edit_Q0_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub75" class="code">function edit_Q0_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub76" class="code">function edit_Q1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub77" class="code">function edit_Q1_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub78" class="code">function edit_Q2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub79" class="code">function edit_Q2_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub80" class="code">function edit_Q3_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub81" class="code">function edit_Q3_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub82" class="code">function edit_pxq_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub83" class="code">function edit_pxq_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub84" class="code">function edit_pyq_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub85" class="code">function edit_pyq_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub86" class="code">function edit_pzq_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub87" class="code">function edit_pzq_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub88" class="code">function pushbutton_moveQ_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub89" class="code">function pushbutton_save_target_point_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub90" class="code">function edit_target_point_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub91" class="code">function edit_target_point_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub92" class="code">function popupmenu6_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub93" class="code">function popupmenu6_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub94" class="code">function pushbutton_simulate_instruction_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub95" class="code">function pushbutton_save_instruction_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub96" class="code">function slider_q1_KeyPressFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub97" class="code">function popupmenu_base_end_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub98" class="code">function popupmenu_base_end_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub99" class="code">function update_T_Q()</a></li><li><a href="#_sub100" class="code">function [T,Q,P]=get_TQ_from_dialog()</a></li><li><a href="#_sub101" class="code">function update_sliders()</a></li><li><a href="#_sub102" class="code">function path=lineal_path_plan(q_ini, q_final)</a></li><li><a href="#_sub103" class="code">function path=lineal_path_planXYZ(P_ini, P_final)</a></li><li><a href="#_sub104" class="code">function follow_line(P_ini,P_final)</a></li><li><a href="#_sub105" class="code">function draw_target_points()</a></li><li><a href="#_sub106" class="code">function tp = construct_target(target_num)</a></li><li><a href="#_sub107" class="code">function [name, Q, T, conf]=get_targetpoint_from_string(a)</a></li><li><a href="#_sub108" class="code">function [instruction_matlab, instruction_rapid, tp1, tp2, joint_coord]=build_instruction_to_eval()</a></li><li><a href="#_sub109" class="code">function [instruction_matlab, instruction_rapid]=build_instruction_to_save()</a></li><li><a href="#_sub110" class="code">function popupmenu_line_reorient_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub111" class="code">function popupmenu_line_reorient_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub112" class="code">function pushbutton_show_target_point_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub113" class="code">function pushbutton_show_target_point_KeyPressFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub114" class="code">function popupmenu_resolution_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub115" class="code">function popupmenu_resolution_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub116" class="code">function pushbutton_reset_all_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub117" class="code">function pushbutton_save_target_point_KeyPressFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub118" class="code">function index=find_closest(q,qi)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = teach(varargin)</a>
0002 <span class="comment">%</span>
0003 <span class="comment">% TEACH MATLAB code for teach.fig</span>
0004 <span class="comment">%      TEACH, by itself, creates a new TEACH or raises the existing</span>
0005 <span class="comment">%      singleton*.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%      H = TEACH returns the handle to a new TEACH or the handle to</span>
0008 <span class="comment">%      the existing singleton*.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%      TEACH('CALLBACK',hObject,eventData,handles,...) calls the local</span>
0011 <span class="comment">%      function named CALLBACK in TEACH.M with the given input arguments.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%      TEACH('Property','Value',...) creates a new TEACH or raises the</span>
0014 <span class="comment">%      existing singleton*.  Starting from the left, property value pairs are</span>
0015 <span class="comment">%      applied to the GUI before teach_OpeningFcn gets called.  An</span>
0016 <span class="comment">%      unrecognized property name or invalid value makes property application</span>
0017 <span class="comment">%      stop.  All inputs are passed to teach_OpeningFcn via varargin.</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one</span>
0020 <span class="comment">%      instance to run (singleton)&quot;.</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% See also: GUIDE, GUIDATA, GUIHANDLES</span>
0023 
0024 <span class="comment">% Copyright (C) 2012, by Arturo Gil Aparicio</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% This file is part of ARTE (A Robotics Toolbox for Education).</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% ARTE is free software: you can redistribute it and/or modify</span>
0029 <span class="comment">% it under the terms of the GNU Lesser General Public License as published by</span>
0030 <span class="comment">% the Free Software Foundation, either version 3 of the License, or</span>
0031 <span class="comment">% (at your option) any later version.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% ARTE is distributed in the hope that it will be useful,</span>
0034 <span class="comment">% but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0035 <span class="comment">% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0036 <span class="comment">% GNU Lesser General Public License for more details.</span>
0037 <span class="comment">%</span>
0038 <span class="comment">% You should have received a copy of the GNU Leser General Public License</span>
0039 <span class="comment">% along with ARTE.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0040 
0041 <span class="comment">% Edit the above text to modify the response to help teach</span>
0042 
0043 <span class="comment">% Last Modified by GUIDE v2.5 21-Dec-2012 16:51:21</span>
0044 <span class="keyword">global</span> configuration robot 
0045 <span class="keyword">global</span> controls program
0046 
0047 
0048 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0049 gui_Singleton = 1;
0050 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0051                    <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0052                    <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction teach_OpeningFcn(hObject, eventdata, handles, varargin)">teach_OpeningFcn</a>, <span class="keyword">...</span>
0053                    <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = teach_OutputFcn(hObject, eventdata, handles)">teach_OutputFcn</a>, <span class="keyword">...</span>
0054                    <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0055                    <span class="string">'gui_Callback'</span>,   []);
0056 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0057     gui_State.gui_Callback = str2func(varargin{1});
0058 <span class="keyword">end</span>
0059 
0060 <span class="keyword">if</span> nargout
0061     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});    
0062 <span class="keyword">else</span>
0063     gui_mainfcn(gui_State, varargin{:});
0064 <span class="keyword">end</span>
0065 <span class="comment">% End initialization code - DO NOT EDIT</span>
0066 
0067   
0068 
0069 <span class="comment">% --- Executes just before teach is made visible.</span>
0070 <a name="_sub1" href="#_subfunctions" class="code">function teach_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0071 <span class="comment">% This function has no output args, see OutputFcn.</span>
0072 <span class="comment">% hObject    handle to figure</span>
0073 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0074 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0075 <span class="comment">% varargin   command line arguments to teach (see VARARGIN)</span>
0076 
0077 <span class="comment">% Choose default command line output for teach</span>
0078 handles.output = hObject;
0079 
0080 <span class="comment">% Update handles structure</span>
0081 guidata(hObject, handles);
0082 
0083 <span class="comment">% UIWAIT makes teach wait for user response (see UIRESUME)</span>
0084 <span class="comment">% uiwait(handles.figure1);</span>
0085 
0086 <span class="comment">%initialize application variables</span>
0087 <span class="keyword">global</span> robot configuration controls targets program
0088 
0089 <span class="comment">%reset program</span>
0090 program=[];
0091 program.program_counter=0;
0092 program.n_lines=0; <span class="comment">%counter for the number of matlab lines</span>
0093 
0094 program.rapid_lines=[];
0095 program.matlab_lines=[];
0096 
0097 <span class="comment">%reset targets</span>
0098 targets=[];
0099 
0100 controls.num_target_points=0;
0101 controls.global_gui_handle=hObject;
0102 
0103 robot.q=zeros(1,robot.DOF)';
0104 
0105 <span class="comment">%reset position velocity acceleration and time</span>
0106 robot.q_vector=[];
0107 robot.qd_vector=[];
0108 robot.qdd_vector=[];
0109 robot.time=[];
0110 
0111 
0112 <span class="comment">%update T and Q in the program</span>
0113 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>()
0114 
0115 figure(configuration.figure.robot);
0116 
0117 disp(<span class="string">'Select the desired view for your robot'</span>)
0118 <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
0119 
0120 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0121 <a name="_sub2" href="#_subfunctions" class="code">function varargout = teach_OutputFcn(hObject, eventdata, handles) </a>
0122 <span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
0123 <span class="comment">% hObject    handle to figure</span>
0124 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0125 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0126 
0127 <span class="comment">% Get default command line output from handles structure</span>
0128 varargout{1} = handles.output;
0129 
0130 
0131 <span class="comment">% --- Executes on selection change in popupmenu_instruction.</span>
0132 <a name="_sub3" href="#_subfunctions" class="code">function popupmenu_instruction_Callback(hObject, eventdata, handles)</a>
0133 <span class="comment">% hObject    handle to popupmenu_instruction (see GCBO)</span>
0134 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0135 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0136 
0137 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu_instruction contents as cell array</span>
0138 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_instruction</span>
0139 
0140 
0141 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0142 <a name="_sub4" href="#_subfunctions" class="code">function popupmenu_instruction_CreateFcn(hObject, eventdata, handles)</a>
0143 <span class="comment">% hObject    handle to popupmenu_instruction (see GCBO)</span>
0144 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0145 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0146 <span class="keyword">global</span> controls
0147 
0148 controls.popupmenu_instruction=hObject;
0149 
0150 
0151 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0152 <span class="comment">%       See ISPC and COMPUTER.</span>
0153 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0154     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0155 <span class="keyword">end</span>
0156 
0157 
0158 <span class="comment">% --- Executes on selection change in listbox1.</span>
0159 <a name="_sub5" href="#_subfunctions" class="code">function listbox1_Callback(hObject, eventdata, handles)</a>
0160 <span class="comment">% hObject    handle to listbox1 (see GCBO)</span>
0161 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0162 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0163 
0164 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns listbox1 contents as cell array</span>
0165 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox1</span>
0166 
0167 
0168 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0169 <a name="_sub6" href="#_subfunctions" class="code">function listbox1_CreateFcn(hObject, eventdata, handles)</a>
0170 <span class="comment">% hObject    handle to listbox1 (see GCBO)</span>
0171 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0172 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0173 
0174 <span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
0175 <span class="comment">%       See ISPC and COMPUTER.</span>
0176 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0177     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0178 <span class="keyword">end</span>
0179 
0180 
0181 <span class="comment">% --- Executes on selection change in popupmenu_target_point.</span>
0182 <a name="_sub7" href="#_subfunctions" class="code">function popupmenu_target_point_Callback(hObject, eventdata, handles)</a>
0183 <span class="comment">% hObject    handle to popupmenu_target_point (see GCBO)</span>
0184 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0185 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0186 
0187 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu_target_point contents as cell array</span>
0188 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_target_point</span>
0189 
0190 
0191 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0192 <a name="_sub8" href="#_subfunctions" class="code">function popupmenu_target_point_CreateFcn(hObject, eventdata, handles)</a>
0193 <span class="comment">% hObject    handle to popupmenu_target_point (see GCBO)</span>
0194 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0195 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0196 
0197 <span class="keyword">global</span> controls
0198 controls.popupmenu_target_point=hObject;
0199 
0200 
0201 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0202 <span class="comment">%       See ISPC and COMPUTER.</span>
0203 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0204     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0205 <span class="keyword">end</span>
0206 
0207 
0208 <span class="comment">% --- Executes on selection change in popupmenu_through_point.</span>
0209 <a name="_sub9" href="#_subfunctions" class="code">function popupmenu_through_point_Callback(hObject, eventdata, handles)</a>
0210 <span class="comment">% hObject    handle to popupmenu_through_point (see GCBO)</span>
0211 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0212 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0213 
0214 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu_through_point contents as cell array</span>
0215 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_through_point</span>
0216 
0217 
0218 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0219 <a name="_sub10" href="#_subfunctions" class="code">function popupmenu_through_point_CreateFcn(hObject, eventdata, handles)</a>
0220 <span class="comment">% hObject    handle to popupmenu_through_point (see GCBO)</span>
0221 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0222 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0223 <span class="keyword">global</span> controls
0224 controls.popupmenu_through_point=hObject;
0225 
0226 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0227 <span class="comment">%       See ISPC and COMPUTER.</span>
0228 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0229     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0230 <span class="keyword">end</span>
0231 
0232 
0233 <span class="comment">% --- Executes on selection change in popupmenu_speed.</span>
0234 <a name="_sub11" href="#_subfunctions" class="code">function popupmenu_speed_Callback(hObject, eventdata, handles)</a>
0235 <span class="comment">% hObject    handle to popupmenu_speed (see GCBO)</span>
0236 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0237 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0238 
0239 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu_speed contents as cell array</span>
0240 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_speed</span>
0241 
0242 
0243 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0244 <a name="_sub12" href="#_subfunctions" class="code">function popupmenu_speed_CreateFcn(hObject, eventdata, handles)</a>
0245 <span class="comment">% hObject    handle to popupmenu_speed (see GCBO)</span>
0246 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0247 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0248 
0249 <span class="keyword">global</span> controls
0250 controls.popupmenu_speed=hObject;
0251 
0252 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0253 <span class="comment">%       See ISPC and COMPUTER.</span>
0254 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0255     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0256 <span class="keyword">end</span>
0257 
0258 
0259 <span class="comment">% --- Executes on button press in pushbutton1.</span>
0260 <a name="_sub13" href="#_subfunctions" class="code">function pushbutton1_Callback(hObject, eventdata, handles)</a>
0261 <span class="comment">% hObject    handle to pushbutton1 (see GCBO)</span>
0262 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0263 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0264 
0265 
0266 <span class="comment">% --- Executes on selection change in popupmenu_precision.</span>
0267 <a name="_sub14" href="#_subfunctions" class="code">function popupmenu_precision_Callback(hObject, eventdata, handles)</a>
0268 <span class="comment">% hObject    handle to popupmenu_precision (see GCBO)</span>
0269 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0270 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0271 
0272 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu_precision contents as cell array</span>
0273 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_precision</span>
0274 
0275 
0276 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0277 <a name="_sub15" href="#_subfunctions" class="code">function popupmenu_precision_CreateFcn(hObject, eventdata, handles)</a>
0278 <span class="comment">% hObject    handle to popupmenu_precision (see GCBO)</span>
0279 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0280 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0281 <span class="keyword">global</span> controls
0282 controls.popupmenu_precision=hObject;
0283 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0284 <span class="comment">%       See ISPC and COMPUTER.</span>
0285 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0286     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0287 <span class="keyword">end</span>
0288 
0289 
0290 <span class="comment">% --- Executes on slider movement.</span>
0291 <a name="_sub16" href="#_subfunctions" class="code">function slider_q1_Callback(hObject, eventdata, handles)</a>
0292 <span class="comment">% hObject    handle to slider_q1 (see GCBO)</span>
0293 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0294 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0295 
0296 <span class="comment">% Hints: get(hObject,'Value') returns position of slider</span>
0297 <span class="comment">%        get(hObject,'Min') and get(hObject,'Max') to determine range of slider</span>
0298 
0299 <span class="keyword">global</span> configuration robot controls
0300 slider_value = get(hObject,<span class="string">'Value'</span>);
0301 set(controls.edit_q1, <span class="string">'String'</span>, num2str(slider_value));
0302 <span class="comment">%convert to rads and store</span>
0303 <span class="keyword">if</span> robot.kind(1)==<span class="string">'R'</span>
0304     robot.q(1) = slider_value*pi/180;<span class="comment">%rad</span>
0305 <span class="keyword">else</span>
0306     robot.q(1) = slider_value;<span class="comment">%m</span>
0307 <span class="keyword">end</span>
0308 
0309 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0310 figure(configuration.figure.robot);
0311 <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
0312 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0313 
0314 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0315 <a name="_sub17" href="#_subfunctions" class="code">function slider_q1_CreateFcn(hObject, eventdata, handles)</a>
0316 <span class="comment">% hObject    handle to slider_q1 (see GCBO)</span>
0317 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0318 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0319 <span class="keyword">global</span> robot controls
0320 controls.slider_q1=hObject;
0321 
0322 
0323 <span class="keyword">if</span> robot.DOF&gt;0
0324     <span class="comment">%modify the limits of the slider object to fit max and min limits</span>
0325     set(hObject, <span class="string">'Min'</span>,robot.maxangle(1,1)*180/pi,<span class="string">'Max'</span>,robot.maxangle(1,2)*180/pi, <span class="string">'Value'</span>,0,<span class="string">'SliderStep'</span>,[0.005 0.2]);
0326 <span class="keyword">else</span> 
0327     disp(<span class="string">'\nPlease set robot.DOF correspondingly'</span>)
0328 <span class="keyword">end</span>
0329 
0330 <span class="comment">% Hint: slider controls usually have a light gray background.</span>
0331 <span class="keyword">if</span> isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0332     set(hObject,<span class="string">'BackgroundColor'</span>,[.9 .9 .9]);
0333 <span class="keyword">end</span>
0334 
0335 
0336 
0337 
0338 <span class="comment">% --- Executes on slider movement.</span>
0339 <a name="_sub18" href="#_subfunctions" class="code">function slider_q2_Callback(hObject, eventdata, handles)</a>
0340 <span class="comment">% hObject    handle to slider_q2 (see GCBO)</span>
0341 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0342 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0343 
0344 <span class="comment">% Hints: get(hObject,'Value') returns position of slider</span>
0345 <span class="comment">%        get(hObject,'Min') and get(hObject,'Max') to determine range of slider</span>
0346 <span class="keyword">global</span> configuration robot controls
0347 slider_value = get(hObject,<span class="string">'Value'</span>);
0348 set(controls.edit_q2, <span class="string">'String'</span>, num2str(slider_value));
0349 <span class="comment">%convert to rads and store</span>
0350 <span class="keyword">if</span> robot.kind(2)==<span class="string">'R'</span>
0351     robot.q(2) = slider_value*pi/180;<span class="comment">%rad</span>
0352 <span class="keyword">else</span>
0353     robot.q(2) = slider_value;<span class="comment">%m</span>
0354 <span class="keyword">end</span>
0355 
0356 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0357 figure(configuration.figure.robot);
0358 <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
0359 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0360 
0361 
0362 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0363 <a name="_sub19" href="#_subfunctions" class="code">function slider_q2_CreateFcn(hObject, eventdata, handles)</a>
0364 <span class="comment">% hObject    handle to slider_q2 (see GCBO)</span>
0365 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0366 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0367 
0368 <span class="keyword">global</span> robot controls
0369 controls.slider_q2=hObject;
0370 
0371 
0372 <span class="keyword">if</span> robot.DOF&gt;1
0373     <span class="comment">%modify the limits of the slider object to fit max and min limits</span>
0374     set(hObject, <span class="string">'Min'</span>,robot.maxangle(2,1)*180/pi,<span class="string">'Max'</span>,robot.maxangle(2,2)*180/pi, <span class="string">'Value'</span>,0,<span class="string">'SliderStep'</span>,[0.005 0.2]);
0375 <span class="keyword">else</span> 
0376     <span class="comment">%make the control disappear</span>
0377      set(hObject, <span class="string">'Min'</span>,0,<span class="string">'Max'</span>,0, <span class="string">'Value'</span>,0);
0378     disp(<span class="string">'\nPlease set robot.DOF correspondingly'</span>)
0379 <span class="keyword">end</span>
0380 
0381 <span class="comment">% Hint: slider controls usually have a light gray background.</span>
0382 <span class="keyword">if</span> isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0383     set(hObject,<span class="string">'BackgroundColor'</span>,[.9 .9 .9]);
0384 <span class="keyword">end</span>
0385 
0386 
0387 <span class="comment">% --- Executes on slider movement.</span>
0388 <a name="_sub20" href="#_subfunctions" class="code">function slider_q3_Callback(hObject, eventdata, handles)</a>
0389 <span class="comment">% hObject    handle to slider_q3 (see GCBO)</span>
0390 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0391 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0392 
0393 <span class="comment">% Hints: get(hObject,'Value') returns position of slider</span>
0394 <span class="comment">%        get(hObject,'Min') and get(hObject,'Max') to determine range of slider</span>
0395 
0396 <span class="keyword">global</span> configuration robot controls
0397 slider_value = get(hObject,<span class="string">'Value'</span>);
0398 set(controls.edit_q3, <span class="string">'String'</span>, num2str(slider_value));
0399 <span class="comment">%convert to rads and store</span>
0400 <span class="keyword">if</span> robot.kind(3)==<span class="string">'R'</span>
0401     robot.q(3) = slider_value*pi/180;<span class="comment">%rad</span>
0402 <span class="keyword">else</span>
0403     robot.q(3) = slider_value;<span class="comment">%m</span>
0404 <span class="keyword">end</span>
0405 figure(configuration.figure.robot);
0406 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0407 <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
0408 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0409 
0410 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0411 <a name="_sub21" href="#_subfunctions" class="code">function slider_q3_CreateFcn(hObject, eventdata, handles)</a>
0412 <span class="comment">% hObject    handle to slider_q3 (see GCBO)</span>
0413 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0414 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0415 
0416 
0417 <span class="keyword">global</span> robot controls
0418 controls.slider_q3=hObject;
0419 
0420 <span class="keyword">if</span> robot.DOF&gt;2
0421     <span class="comment">%modify the limits of the slider object to fit max and min limits</span>
0422     set(hObject, <span class="string">'Min'</span>,robot.maxangle(3,1)*180/pi,<span class="string">'Max'</span>,robot.maxangle(3,2)*180/pi, <span class="string">'Value'</span>,0,<span class="string">'SliderStep'</span>,[0.005 0.2]);
0423 <span class="keyword">else</span> 
0424     <span class="comment">%make the control disappear</span>
0425      set(hObject, <span class="string">'Min'</span>,0,<span class="string">'Max'</span>,0, <span class="string">'Value'</span>,0);
0426     disp(<span class="string">'\nPlease set robot.DOF correspondingly'</span>)
0427 <span class="keyword">end</span>
0428 
0429 <span class="comment">% Hint: slider controls usually have a light gray background.</span>
0430 <span class="keyword">if</span> isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0431     set(hObject,<span class="string">'BackgroundColor'</span>,[.9 .9 .9]);
0432 <span class="keyword">end</span>
0433 
0434 
0435 <span class="comment">% --- Executes on slider movement.</span>
0436 <a name="_sub22" href="#_subfunctions" class="code">function slider_q4_Callback(hObject, eventdata, handles)</a>
0437 <span class="comment">% hObject    handle to slider_q4 (see GCBO)</span>
0438 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0439 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0440 
0441 <span class="comment">% Hints: get(hObject,'Value') returns position of slider</span>
0442 <span class="comment">%        get(hObject,'Min') and get(hObject,'Max') to determine range of slider</span>
0443 
0444 <span class="keyword">global</span> configuration robot controls
0445 slider_value = get(hObject,<span class="string">'Value'</span>);
0446 set(controls.edit_q4, <span class="string">'String'</span>, num2str(slider_value));
0447 <span class="comment">%convert to rads and store</span>
0448 <span class="keyword">if</span> robot.kind(4)==<span class="string">'R'</span>
0449     robot.q(4) = slider_value*pi/180;<span class="comment">%rad</span>
0450 <span class="keyword">else</span>
0451     robot.q(4) = slider_value;<span class="comment">%m</span>
0452 <span class="keyword">end</span>
0453 
0454 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0455 figure(configuration.figure.robot);
0456 <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
0457 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0458 
0459 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0460 <a name="_sub23" href="#_subfunctions" class="code">function slider_q4_CreateFcn(hObject, eventdata, handles)</a>
0461 <span class="comment">% hObject    handle to slider_q4 (see GCBO)</span>
0462 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0463 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0464 
0465 
0466 <span class="keyword">global</span> robot controls
0467 controls.slider_q4=hObject;
0468 <span class="keyword">if</span> robot.DOF&gt;3
0469     <span class="comment">%modify the limits of the slider object to fit max and min limits</span>
0470     set(hObject, <span class="string">'Min'</span>,robot.maxangle(4,1)*180/pi,<span class="string">'Max'</span>,robot.maxangle(4,2)*180/pi, <span class="string">'Value'</span>,0,<span class="string">'SliderStep'</span>,[0.005 0.2]);
0471 <span class="keyword">else</span> 
0472     <span class="comment">%make the control disappear</span>
0473      set(hObject, <span class="string">'Min'</span>,0,<span class="string">'Max'</span>,0, <span class="string">'Value'</span>,0);
0474     disp(<span class="string">'\nPlease set robot.DOF correspondingly'</span>)
0475 <span class="keyword">end</span>
0476 
0477 
0478 <span class="comment">% Hint: slider controls usually have a light gray background.</span>
0479 <span class="keyword">if</span> isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0480     set(hObject,<span class="string">'BackgroundColor'</span>,[.9 .9 .9]);
0481 <span class="keyword">end</span>
0482 
0483 
0484 <span class="comment">% --- Executes on slider movement.</span>
0485 <a name="_sub24" href="#_subfunctions" class="code">function slider_q5_Callback(hObject, eventdata, handles)</a>
0486 <span class="comment">% hObject    handle to slider_q5 (see GCBO)</span>
0487 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0488 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0489 
0490 <span class="comment">% Hints: get(hObject,'Value') returns position of slider</span>
0491 <span class="comment">%        get(hObject,'Min') and get(hObject,'Max') to determine range of slider</span>
0492 
0493 <span class="keyword">global</span> configuration robot controls
0494 slider_value = get(hObject,<span class="string">'Value'</span>);
0495 set(controls.edit_q5, <span class="string">'String'</span>, num2str(slider_value));
0496 <span class="comment">%convert to rads and store</span>
0497 <span class="keyword">if</span> robot.kind(5)==<span class="string">'R'</span>
0498     robot.q(5) = slider_value*pi/180;<span class="comment">%rad</span>
0499 <span class="keyword">else</span>
0500     robot.q(5) = slider_value;<span class="comment">%m</span>
0501 <span class="keyword">end</span>
0502 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0503 figure(configuration.figure.robot);
0504 <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
0505 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0506 
0507 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0508 <a name="_sub25" href="#_subfunctions" class="code">function slider_q5_CreateFcn(hObject, eventdata, handles)</a>
0509 <span class="comment">% hObject    handle to slider_q5 (see GCBO)</span>
0510 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0511 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0512 
0513 
0514 <span class="keyword">global</span> robot controls
0515 controls.slider_q5=hObject;
0516 <span class="keyword">if</span> robot.DOF&gt;4
0517     <span class="comment">%modify the limits of the slider object to fit max and min limits</span>
0518     set(hObject, <span class="string">'Min'</span>,robot.maxangle(5,1)*180/pi,<span class="string">'Max'</span>,robot.maxangle(5,2)*180/pi, <span class="string">'Value'</span>,0,<span class="string">'SliderStep'</span>,[0.005 0.2]);
0519 <span class="keyword">else</span> 
0520     <span class="comment">%make the control disappear</span>
0521      set(hObject, <span class="string">'Min'</span>,0,<span class="string">'Max'</span>,0, <span class="string">'Value'</span>,0);
0522     disp(<span class="string">'\nPlease set robot.DOF correspondingly'</span>)
0523 <span class="keyword">end</span>
0524 
0525 
0526 <span class="comment">% Hint: slider controls usually have a light gray background.</span>
0527 <span class="keyword">if</span> isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0528     set(hObject,<span class="string">'BackgroundColor'</span>,[.9 .9 .9]);
0529 <span class="keyword">end</span>
0530 
0531 
0532 <span class="comment">% --- Executes on slider movement.</span>
0533 <a name="_sub26" href="#_subfunctions" class="code">function slider_q6_Callback(hObject, eventdata, handles)</a>
0534 <span class="comment">% hObject    handle to slider_q6 (see GCBO)</span>
0535 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0536 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0537 
0538 <span class="comment">% Hints: get(hObject,'Value') returns position of slider</span>
0539 <span class="comment">%        get(hObject,'Min') and get(hObject,'Max') to determine range of slider</span>
0540 
0541 <span class="keyword">global</span> configuration robot controls
0542 slider_value = get(hObject,<span class="string">'Value'</span>);
0543 set(controls.edit_q6, <span class="string">'String'</span>, num2str(slider_value));
0544 <span class="comment">%convert to rads and store</span>
0545 <span class="keyword">if</span> robot.kind(6)==<span class="string">'R'</span>
0546     robot.q(6) = slider_value*pi/180;<span class="comment">%rad</span>
0547 <span class="keyword">else</span>
0548     robot.q(6) = slider_value;<span class="comment">%m</span>
0549 <span class="keyword">end</span>
0550 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0551 figure(configuration.figure.robot);
0552 <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
0553 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0554 
0555 
0556 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0557 <a name="_sub27" href="#_subfunctions" class="code">function slider_q6_CreateFcn(hObject, eventdata, handles)</a>
0558 <span class="comment">% hObject    handle to slider_q6 (see GCBO)</span>
0559 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0560 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0561 
0562 
0563 <span class="keyword">global</span> robot controls
0564 
0565 controls.slider_q6=hObject;
0566 
0567 <span class="keyword">if</span> robot.DOF&gt;5
0568     <span class="comment">%modify the limits of the slider object to fit max and min limits</span>
0569     set(hObject, <span class="string">'Min'</span>,robot.maxangle(6,1)*180/pi,<span class="string">'Max'</span>,robot.maxangle(6,2)*180/pi, <span class="string">'Value'</span>,0,<span class="string">'SliderStep'</span>,[0.005 0.2]);
0570 <span class="keyword">else</span> 
0571     <span class="comment">%make the control disappear</span>
0572      set(hObject, <span class="string">'Min'</span>,0,<span class="string">'Max'</span>,0, <span class="string">'Value'</span>,0);
0573     disp(<span class="string">'\nPlease set robot.DOF correspondingly'</span>)
0574 <span class="keyword">end</span>
0575 
0576 
0577 <span class="comment">% Hint: slider controls usually have a light gray background.</span>
0578 <span class="keyword">if</span> isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0579     set(hObject,<span class="string">'BackgroundColor'</span>,[.9 .9 .9]);
0580 <span class="keyword">end</span>
0581 
0582 
0583 
0584 
0585 <span class="comment">% --- Executes on button press in pushbutton_x_minus.</span>
0586 <a name="_sub28" href="#_subfunctions" class="code">function pushbutton_x_minus_Callback(hObject, eventdata, handles)</a>
0587 <span class="comment">% hObject    handle to pushbutton_x_minus (see GCBO)</span>
0588 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0589 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0590 
0591 <span class="keyword">global</span> robot controls
0592 
0593 
0594 <span class="comment">%FIND RESOLUTION OF MOVEMENT</span>
0595 resolution=get(controls.popupmenu_resolution,<span class="string">'Value'</span>);
0596 <span class="keyword">if</span> resolution==3 <span class="comment">%low</span>
0597     delta=0.001; <span class="comment">%m</span>
0598 <span class="keyword">end</span>
0599 <span class="keyword">if</span> resolution==2
0600     delta=0.1; <span class="comment">%m</span>
0601 <span class="keyword">end</span>
0602 <span class="keyword">if</span> resolution==1
0603     delta=0.2; <span class="comment">%m</span>
0604 <span class="keyword">end</span>
0605 
0606 
0607 
0608 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
0609 P_ini=T(1:3,4);
0610 <span class="comment">% FIND KIND OF MOVEMENT, LINES OR REORIENTATION</span>
0611 line_reorient=get(controls.popupmenu_line_reorient,<span class="string">'Value'</span>);
0612 
0613 <span class="comment">% MOVE IN LINES</span>
0614 <span class="keyword">if</span> line_reorient==1
0615     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0616     
0617     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0618         P_final = P_ini;
0619         P_final(1) = P_ini(1) - delta;
0620     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0621         P_final = P_ini - delta*T(1:3,1);
0622     <span class="keyword">end</span>
0623     
0624     <a href="#_sub104" class="code" title="subfunction follow_line(P_ini,P_final)">follow_line</a>(P_ini,P_final);
0625     
0626 <span class="keyword">else</span><span class="comment">% REORIENTATION</span>
0627     
0628     <span class="comment">%compute objective T with rotation</span>
0629     Trot = [1    0          0        0;
0630         0 cos(-delta) -sin(-delta) 0;
0631         0  sin(-delta) cos(-delta) 0;
0632         0   0              0     1];
0633     
0634     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0635     
0636     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0637         T_final = Trot*T;
0638     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0639         T_final = T*Trot;
0640     <span class="keyword">end</span>
0641     
0642     ejes_ext = [9E+09,9E+09,9E+09,9E+09,9E+09,9E+09];
0643     conf=<a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);
0644     
0645     
0646     <span class="comment">%convert to quaternion</span>
0647     Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T_final);
0648     Q=real(Q);
0649     tp=[[P_ini'],[Q],conf,ejes_ext];
0650     
0651     command =[<span class="string">'[robot] = MoveL(robot,tp,'</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'vmax'</span>) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'fine'</span>) <span class="string">',robot.tool0, robot.wobj0);'</span>];
0652     eval(command);
0653 <span class="keyword">end</span>
0654 
0655 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0656 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
0657 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0658 
0659 
0660 <span class="comment">% --- Executes on button press in pushbutton_x_plus.</span>
0661 <a name="_sub29" href="#_subfunctions" class="code">function pushbutton_x_plus_Callback(hObject, eventdata, handles)</a>
0662 <span class="comment">% hObject    handle to pushbutton_x_plus (see GCBO)</span>
0663 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0664 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0665 
0666 <span class="keyword">global</span> robot controls
0667 <span class="comment">%substract this quantity to X in base coordinates</span>
0668 <span class="comment">%compute total movement</span>
0669 resolution=get(controls.popupmenu_resolution,<span class="string">'Value'</span>);
0670 <span class="keyword">if</span> resolution==3 <span class="comment">%low</span>
0671     delta=0.001; <span class="comment">%m</span>
0672 <span class="keyword">end</span>
0673 <span class="keyword">if</span> resolution==2
0674     delta=0.1; <span class="comment">%m</span>
0675 <span class="keyword">end</span>
0676 <span class="keyword">if</span> resolution==1
0677     delta=0.2; <span class="comment">%m</span>
0678 <span class="keyword">end</span>
0679 
0680 
0681 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
0682 P_ini=T(1:3,4);
0683 <span class="comment">% FIND KIND OF MOVEMENT, LINES OR REORIENTATION</span>
0684 line_reorient=get(controls.popupmenu_line_reorient,<span class="string">'Value'</span>);
0685 
0686 <span class="comment">% MOVE IN LINES</span>
0687 <span class="keyword">if</span> line_reorient==1
0688     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0689     
0690     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0691         P_final = P_ini;
0692         P_final(1) = P_ini(1) + delta;
0693     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0694         P_final = P_ini + delta*T(1:3,1);
0695     <span class="keyword">end</span>
0696     
0697     <a href="#_sub104" class="code" title="subfunction follow_line(P_ini,P_final)">follow_line</a>(P_ini,P_final);
0698     
0699 <span class="keyword">else</span><span class="comment">% REORIENTATION</span>
0700     
0701     <span class="comment">%compute objective T with rotation</span>
0702     Trot = [1    0          0        0;
0703         0 cos(delta) -sin(delta) 0;
0704         0  sin(delta) cos(delta) 0;
0705         0   0              0     1];
0706     
0707     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0708     
0709     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0710         T_final = Trot*T;
0711     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0712         T_final = T*Trot;
0713     <span class="keyword">end</span>
0714     
0715     ejes_ext = [9E+09,9E+09,9E+09,9E+09,9E+09,9E+09];
0716     conf=<a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);
0717     
0718     
0719     <span class="comment">%convert to quaternion</span>
0720     Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T_final);
0721     Q=real(Q);
0722     tp=[[P_ini'],[Q],conf,ejes_ext];
0723     
0724     command =[<span class="string">'[robot] = MoveL(robot,tp,'</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'vmax'</span>) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'fine'</span>) <span class="string">',robot.tool0, robot.wobj0);'</span>];
0725     eval(command);
0726 <span class="keyword">end</span>
0727 
0728 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0729 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
0730 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0731 
0732 
0733 <span class="comment">% --- Executes on button press in pushbutton_y_plus.</span>
0734 <a name="_sub30" href="#_subfunctions" class="code">function pushbutton_y_plus_Callback(hObject, eventdata, handles)</a>
0735 <span class="comment">% hObject    handle to pushbutton_y_plus (see GCBO)</span>
0736 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0737 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0738 
0739 
0740 <span class="keyword">global</span> robot controls
0741 <span class="comment">%substract this quantity to X in base coordinates</span>
0742 <span class="comment">%compute total movement</span>
0743 resolution=get(controls.popupmenu_resolution,<span class="string">'Value'</span>);
0744 <span class="keyword">if</span> resolution==3 <span class="comment">%low</span>
0745     delta=0.001; <span class="comment">%m</span>
0746 <span class="keyword">end</span>
0747 <span class="keyword">if</span> resolution==2
0748     delta=0.1; <span class="comment">%m</span>
0749 <span class="keyword">end</span>
0750 <span class="keyword">if</span> resolution==1
0751     delta=0.2; <span class="comment">%m</span>
0752 <span class="keyword">end</span>
0753 
0754 
0755 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
0756 P_ini=T(1:3,4);
0757 <span class="comment">% FIND KIND OF MOVEMENT, LINES OR REORIENTATION</span>
0758 line_reorient=get(controls.popupmenu_line_reorient,<span class="string">'Value'</span>);
0759 
0760 <span class="comment">% MOVE IN LINES</span>
0761 <span class="keyword">if</span> line_reorient==1
0762     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0763     
0764     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0765         P_final = P_ini;
0766         P_final(2) = P_ini(2) + delta;
0767     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0768         P_final = P_ini + delta*T(1:3,2);
0769     <span class="keyword">end</span>
0770     
0771     <a href="#_sub104" class="code" title="subfunction follow_line(P_ini,P_final)">follow_line</a>(P_ini,P_final);
0772     
0773 <span class="keyword">else</span><span class="comment">% REORIENTATION</span>
0774     
0775     <span class="comment">%compute objective T with rotation</span>
0776     Trot = [cos(delta)    0          sin(delta)        0;
0777             0             1            0                0;
0778             -sin(delta)   0          cos(delta)         0;
0779             0             0              0               1];
0780     
0781     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0782     
0783     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0784         T_final = Trot*T;
0785     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0786         T_final = T*Trot;
0787     <span class="keyword">end</span>
0788     
0789     ejes_ext = [9E+09,9E+09,9E+09,9E+09,9E+09,9E+09];
0790     conf=<a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);
0791     
0792     
0793     <span class="comment">%convert to quaternion</span>
0794     Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T_final);
0795     Q=real(Q);
0796     tp=[[P_ini'],[Q],conf,ejes_ext];
0797     
0798     command =[<span class="string">'[robot] = MoveL(robot,tp,'</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'vmax'</span>) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'fine'</span>) <span class="string">',robot.tool0, robot.wobj0);'</span>];
0799     eval(command);
0800 <span class="keyword">end</span>
0801 
0802 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0803 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
0804 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0805 
0806 <span class="comment">% --- Executes on button press in pushbutton_y_minus.</span>
0807 <a name="_sub31" href="#_subfunctions" class="code">function pushbutton_y_minus_Callback(hObject, eventdata, handles)</a>
0808 <span class="comment">% hObject    handle to pushbutton_y_minus (see GCBO)</span>
0809 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0810 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0811 <span class="keyword">global</span> robot controls
0812 <span class="comment">%substract this quantity to X in base coordinates</span>
0813 <span class="comment">%compute total movement</span>
0814 resolution=get(controls.popupmenu_resolution,<span class="string">'Value'</span>);
0815 <span class="keyword">if</span> resolution==3 <span class="comment">%low</span>
0816     delta=0.001; <span class="comment">%m</span>
0817 <span class="keyword">end</span>
0818 <span class="keyword">if</span> resolution==2
0819     delta=0.1; <span class="comment">%m</span>
0820 <span class="keyword">end</span>
0821 <span class="keyword">if</span> resolution==1
0822     delta=0.2; <span class="comment">%m</span>
0823 <span class="keyword">end</span>
0824 
0825 
0826 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
0827 P_ini=T(1:3,4);
0828 <span class="comment">% FIND KIND OF MOVEMENT, LINES OR REORIENTATION</span>
0829 line_reorient=get(controls.popupmenu_line_reorient,<span class="string">'Value'</span>);
0830 
0831 <span class="comment">% MOVE IN LINES</span>
0832 <span class="keyword">if</span> line_reorient==1
0833     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0834     
0835     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0836         P_final = P_ini;
0837         P_final(2) = P_ini(2) - delta;
0838     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0839         P_final = P_ini - delta*T(1:3,2);
0840     <span class="keyword">end</span>
0841     
0842     <a href="#_sub104" class="code" title="subfunction follow_line(P_ini,P_final)">follow_line</a>(P_ini,P_final);
0843     
0844 <span class="keyword">else</span><span class="comment">% REORIENTATION</span>
0845     
0846     <span class="comment">%compute objective T with rotation</span>
0847     Trot = [cos(-delta)    0          sin(-delta)        0;
0848             0             1            0                0;
0849             -sin(-delta)   0          cos(-delta)         0;
0850             0             0              0               1];
0851     
0852     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0853     
0854     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0855         T_final = Trot*T;
0856     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0857         T_final = T*Trot;
0858     <span class="keyword">end</span>
0859     
0860     ejes_ext = [9E+09,9E+09,9E+09,9E+09,9E+09,9E+09];
0861     conf=<a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);
0862     
0863     
0864     <span class="comment">%convert to quaternion</span>
0865     Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T_final);
0866     Q=real(Q);
0867     tp=[[P_ini'],[Q],conf,ejes_ext];
0868     
0869     command =[<span class="string">'[robot] = MoveL(robot,tp,'</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'vmax'</span>) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'fine'</span>) <span class="string">',robot.tool0, robot.wobj0);'</span>];
0870     eval(command);
0871 <span class="keyword">end</span>
0872 
0873 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0874 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
0875 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0876 
0877 <span class="comment">% --- Executes on button press in pushbutton_z_plus.</span>
0878 <a name="_sub32" href="#_subfunctions" class="code">function pushbutton_z_plus_Callback(hObject, eventdata, handles)</a>
0879 <span class="comment">% hObject    handle to pushbutton_z_plus (see GCBO)</span>
0880 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0881 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0882 
0883 <span class="keyword">global</span> robot controls
0884 <span class="comment">%substract this quantity to X in base coordinates</span>
0885 
0886 <span class="comment">%compute total movement</span>
0887 resolution=get(controls.popupmenu_resolution,<span class="string">'Value'</span>);
0888 <span class="keyword">if</span> resolution==3 <span class="comment">%low</span>
0889     delta=0.001; <span class="comment">%m</span>
0890 <span class="keyword">end</span>
0891 <span class="keyword">if</span> resolution==2
0892     delta=0.1; <span class="comment">%m</span>
0893 <span class="keyword">end</span>
0894 <span class="keyword">if</span> resolution==1
0895     delta=0.2; <span class="comment">%m</span>
0896 <span class="keyword">end</span>
0897 
0898 
0899 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
0900 P_ini=T(1:3,4);
0901 <span class="comment">% FIND KIND OF MOVEMENT, LINES OR REORIENTATION</span>
0902 line_reorient=get(controls.popupmenu_line_reorient,<span class="string">'Value'</span>);
0903 
0904 <span class="comment">% MOVE IN LINES</span>
0905 <span class="keyword">if</span> line_reorient==1
0906     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0907     
0908     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0909         P_final = P_ini;
0910         P_final(3) = P_ini(3) + delta;
0911     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0912         P_final = P_ini + delta*T(1:3,3);
0913     <span class="keyword">end</span>
0914     
0915     <a href="#_sub104" class="code" title="subfunction follow_line(P_ini,P_final)">follow_line</a>(P_ini,P_final);
0916     
0917 <span class="keyword">else</span><span class="comment">% REORIENTATION</span>
0918     
0919     <span class="comment">%compute objective T with rotation</span>
0920     Trot = [cos(delta)       -sin(delta)          0     0;
0921             sin(delta)         cos(delta)         0     0;
0922                 0                  0              1     0;
0923                 0                   0              0    1];
0924     
0925     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0926     
0927     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0928         T_final = Trot*T;
0929     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0930         T_final = T*Trot;
0931     <span class="keyword">end</span>
0932     
0933     ejes_ext = [9E+09,9E+09,9E+09,9E+09,9E+09,9E+09];
0934     conf=<a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);
0935     
0936     
0937     <span class="comment">%convert to quaternion</span>
0938     Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T_final);
0939     Q=real(Q);
0940     tp=[[P_ini'],[Q],conf,ejes_ext];
0941     
0942     command =[<span class="string">'[robot] = MoveL(robot,tp,'</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'vmax'</span>) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'fine'</span>) <span class="string">',robot.tool0, robot.wobj0);'</span>];
0943     eval(command);
0944 <span class="keyword">end</span>
0945 
0946 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
0947 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
0948 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
0949 
0950 <span class="comment">% --- Executes on button press in pushbutton_z_minus.</span>
0951 <a name="_sub33" href="#_subfunctions" class="code">function pushbutton_z_minus_Callback(hObject, eventdata, handles)</a>
0952 <span class="comment">% hObject    handle to pushbutton_z_minus (see GCBO)</span>
0953 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0954 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0955 <span class="keyword">global</span> robot controls
0956 <span class="comment">%substract this quantity to X in base coordinates</span>
0957 <span class="comment">%compute total movement</span>
0958 resolution=get(controls.popupmenu_resolution,<span class="string">'Value'</span>);
0959 <span class="keyword">if</span> resolution==3 <span class="comment">%low</span>
0960     delta=0.001; <span class="comment">%m</span>
0961 <span class="keyword">end</span>
0962 <span class="keyword">if</span> resolution==2
0963     delta=0.1; <span class="comment">%m</span>
0964 <span class="keyword">end</span>
0965 <span class="keyword">if</span> resolution==1
0966     delta=0.2; <span class="comment">%m</span>
0967 <span class="keyword">end</span>
0968 
0969 
0970 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
0971 P_ini=T(1:3,4);
0972 <span class="comment">% FIND KIND OF MOVEMENT, LINES OR REORIENTATION</span>
0973 line_reorient=get(controls.popupmenu_line_reorient,<span class="string">'Value'</span>);
0974 
0975 <span class="comment">% MOVE IN LINES</span>
0976 <span class="keyword">if</span> line_reorient==1
0977     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0978     
0979     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0980         P_final = P_ini;
0981         P_final(3) = P_ini(3) - delta;
0982     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
0983         P_final = P_ini - delta*T(1:3,3);
0984     <span class="keyword">end</span>
0985     
0986     <a href="#_sub104" class="code" title="subfunction follow_line(P_ini,P_final)">follow_line</a>(P_ini,P_final);
0987     
0988 <span class="keyword">else</span><span class="comment">% REORIENTATION</span>
0989     
0990     <span class="comment">%compute objective T with rotation</span>
0991     Trot = [cos(-delta)       -sin(-delta)          0     0;
0992             sin(-delta)         cos(-delta)         0     0;
0993                 0                  0              1     0;
0994                 0                   0              0    1];
0995     
0996     base=get(controls.popupmenu_base_end,<span class="string">'Value'</span>);
0997     
0998     <span class="keyword">if</span> base==1 <span class="comment">%move in base coordinates</span>
0999         T_final = Trot*T;
1000     <span class="keyword">else</span> <span class="comment">%move in end effector's coordinates</span>
1001         T_final = T*Trot;
1002     <span class="keyword">end</span>
1003     
1004     ejes_ext = [9E+09,9E+09,9E+09,9E+09,9E+09,9E+09];
1005     conf=<a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);
1006     
1007     
1008     <span class="comment">%convert to quaternion</span>
1009     Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T_final);
1010     Q=real(Q);
1011     tp=[[P_ini'],[Q],conf,ejes_ext];
1012     
1013     command =[<span class="string">'[robot] = MoveL(robot,tp,'</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'vmax'</span>) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'fine'</span>) <span class="string">',robot.tool0, robot.wobj0);'</span>];
1014     eval(command);
1015 <span class="keyword">end</span>
1016 
1017 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
1018 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
1019 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
1020 
1021 
1022 <a name="_sub34" href="#_subfunctions" class="code">function edit_q1_Callback(hObject, eventdata, handles)</a>
1023 <span class="comment">% hObject    handle to edit_q1 (see GCBO)</span>
1024 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1025 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1026 
1027 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_q1 as text</span>
1028 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_q1 as a double</span>
1029 
1030 
1031 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1032 <a name="_sub35" href="#_subfunctions" class="code">function edit_q1_CreateFcn(hObject, eventdata, handles)</a>
1033 <span class="comment">% hObject    handle to edit_q1 (see GCBO)</span>
1034 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1035 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1036 
1037 <span class="keyword">global</span> controls
1038 
1039 <span class="comment">%save the control so that it can be accessed elsewhere</span>
1040 controls.edit_q1=hObject;
1041 
1042 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1043 <span class="comment">%       See ISPC and COMPUTER.</span>
1044 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1045     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1046     
1047 <span class="keyword">end</span>
1048 
1049 <span class="comment">%set(hObject, 'String', 'Push button pushed')</span>
1050 
1051 <a name="_sub36" href="#_subfunctions" class="code">function edit_q2_Callback(hObject, eventdata, handles)</a>
1052 <span class="comment">% hObject    handle to edit_q2 (see GCBO)</span>
1053 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1054 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1055 
1056 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_q2 as text</span>
1057 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_q2 as a double</span>
1058 
1059 
1060 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1061 <a name="_sub37" href="#_subfunctions" class="code">function edit_q2_CreateFcn(hObject, eventdata, handles)</a>
1062 <span class="comment">% hObject    handle to edit_q2 (see GCBO)</span>
1063 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1064 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1065 
1066 <span class="keyword">global</span> controls
1067 
1068 <span class="comment">%save the control so that it can be accessed elsewhere</span>
1069 controls.edit_q2=hObject;
1070 
1071 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1072 <span class="comment">%       See ISPC and COMPUTER.</span>
1073 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1074     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1075 <span class="keyword">end</span>
1076 
1077 
1078 
1079 <a name="_sub38" href="#_subfunctions" class="code">function edit_q3_Callback(hObject, eventdata, handles)</a>
1080 <span class="comment">% hObject    handle to edit_q3 (see GCBO)</span>
1081 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1082 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1083 
1084 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_q3 as text</span>
1085 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_q3 as a double</span>
1086 
1087 
1088 
1089 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1090 <a name="_sub39" href="#_subfunctions" class="code">function edit_q3_CreateFcn(hObject, eventdata, handles)</a>
1091 <span class="comment">% hObject    handle to edit_q3 (see GCBO)</span>
1092 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1093 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1094 
1095 <span class="keyword">global</span> controls
1096 
1097 <span class="comment">%save the control so that it can be accessed elsewhere</span>
1098 controls.edit_q3=hObject;
1099 
1100 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1101 <span class="comment">%       See ISPC and COMPUTER.</span>
1102 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1103     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1104 <span class="keyword">end</span>
1105 
1106 
1107 
1108 <a name="_sub40" href="#_subfunctions" class="code">function edit_q4_Callback(hObject, eventdata, handles)</a>
1109 <span class="comment">% hObject    handle to edit_q4 (see GCBO)</span>
1110 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1111 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1112 
1113 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_q4 as text</span>
1114 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_q4 as a double</span>
1115 
1116 
1117 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1118 <a name="_sub41" href="#_subfunctions" class="code">function edit_q4_CreateFcn(hObject, eventdata, handles)</a>
1119 <span class="comment">% hObject    handle to edit_q4 (see GCBO)</span>
1120 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1121 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1122 
1123 
1124 <span class="keyword">global</span> controls
1125 
1126 <span class="comment">%save the control so that it can be accessed elsewhere</span>
1127 controls.edit_q4=hObject;
1128 
1129 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1130 <span class="comment">%       See ISPC and COMPUTER.</span>
1131 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1132     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1133 <span class="keyword">end</span>
1134 
1135 
1136 
1137 <a name="_sub42" href="#_subfunctions" class="code">function edit_q5_Callback(hObject, eventdata, handles)</a>
1138 <span class="comment">% hObject    handle to edit_q5 (see GCBO)</span>
1139 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1140 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1141 
1142 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_q5 as text</span>
1143 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_q5 as a double</span>
1144 
1145 
1146 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1147 <a name="_sub43" href="#_subfunctions" class="code">function edit_q5_CreateFcn(hObject, eventdata, handles)</a>
1148 <span class="comment">% hObject    handle to edit_q5 (see GCBO)</span>
1149 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1150 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1151 
1152 
1153 <span class="keyword">global</span> controls
1154 
1155 <span class="comment">%save the control so that it can be accessed elsewhere</span>
1156 controls.edit_q5=hObject;
1157 
1158 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1159 <span class="comment">%       See ISPC and COMPUTER.</span>
1160 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1161     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1162 <span class="keyword">end</span>
1163 
1164 
1165 
1166 <a name="_sub44" href="#_subfunctions" class="code">function edit_q6_Callback(hObject, eventdata, handles)</a>
1167 <span class="comment">% hObject    handle to edit_q6 (see GCBO)</span>
1168 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1169 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1170 
1171 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_q6 as text</span>
1172 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_q6 as a double</span>
1173 
1174 
1175 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1176 <a name="_sub45" href="#_subfunctions" class="code">function edit_q6_CreateFcn(hObject, eventdata, handles)</a>
1177 <span class="comment">% hObject    handle to edit_q6 (see GCBO)</span>
1178 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1179 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1180 
1181 
1182 <span class="keyword">global</span> controls
1183 
1184 <span class="comment">%save the control so that it can be accessed elsewhere</span>
1185 controls.edit_q6=hObject;
1186 
1187 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1188 <span class="comment">%       See ISPC and COMPUTER.</span>
1189 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1190     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1191 <span class="keyword">end</span>
1192 
1193 
1194 <span class="comment">% --- Executes on button press in pushbutton_load.</span>
1195 <a name="_sub46" href="#_subfunctions" class="code">function pushbutton_load_Callback(hObject, eventdata, handles)</a>
1196 <span class="comment">% hObject    handle to pushbutton_load (see GCBO)</span>
1197 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1198 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1199 
1200 <span class="keyword">global</span> program controls targets robot
1201 
1202 program=[];
1203 
1204 <span class="comment">%always require a filename</span>
1205 [filename, pathname] = uigetfile(<span class="string">'*.m'</span>,<span class="string">'Select .m program to load'</span>);
1206 <span class="keyword">if</span> isequal(filename,0)
1207    disp(<span class="string">'User selected Cancel'</span>)
1208    <span class="keyword">return</span>;
1209 <span class="keyword">else</span>
1210    disp([<span class="string">'User selected'</span>, fullfile(pathname, filename)])
1211 <span class="keyword">end</span>
1212 
1213 
1214 <span class="comment">%open selected file for read only</span>
1215 fp=fopen(fullfile(pathname, filename),<span class="string">'r'</span>);
1216 
1217 disp(<span class="string">'Loading target points'</span>);
1218 <span class="keyword">while</span> 1
1219     a = fgets(fp);
1220     k = strfind(a, <span class="string">'%BEGINTARGETPOINTS'</span>);
1221    
1222     <span class="comment">%find beginning of target points</span>
1223     <span class="keyword">if</span> k&gt;=0
1224         <span class="keyword">break</span>;
1225     <span class="keyword">end</span>
1226 <span class="keyword">end</span>
1227 
1228 target_names=[];
1229 <span class="comment">%reset number of target points</span>
1230 N=0;
1231 <span class="comment">%now load target points</span>
1232 <span class="keyword">while</span> 1
1233     a = fgets(fp);
1234     <span class="keyword">if</span> length(a)&lt;=1
1235         <span class="keyword">continue</span>;
1236     <span class="keyword">end</span>
1237     k = strfind(a, <span class="string">'%ENDTARGETPOINTS'</span>);
1238     <span class="comment">%test whether there are no more target points</span>
1239     <span class="keyword">if</span> k&gt;=0
1240         <span class="keyword">break</span>;
1241     <span class="keyword">end</span>
1242     
1243     <span class="comment">%test whether its a valid target point initialization in matlab</span>
1244     k = strfind(a, <span class="string">':='</span>);
1245     <span class="keyword">if</span> k&gt;=0
1246         <span class="keyword">continue</span>;
1247     <span class="keyword">end</span>
1248 
1249     [name, Q, T, conf]=<a href="#_sub107" class="code" title="subfunction [name, Q, T, conf]=get_targetpoint_from_string(a)">get_targetpoint_from_string</a>(a);
1250         
1251     N=N+1;
1252     targets{N}.name=name;
1253     targets{N}.Q=Q;
1254     targets{N}.T=T;
1255     targets{N}.conf=conf;
1256     
1257     
1258     qinv = <a href="../../arte3.1.4/lib/kinematics/inversekinematic.html" class="code" title="function q = inversekinematic(robot, T)">inversekinematic</a>(robot, T);
1259     q = <a href="../../arte3.1.4/RAPID/functions/select_configuration.html" class="code" title="function q=select_configuration(robot, qinv, conf)">select_configuration</a>(robot, qinv, conf);
1260     targets{N}.q=q;
1261     
1262     target_names{N}=name;
1263     
1264     <span class="comment">%store the name in the programming popup storing the available targets.</span>
1265     set(controls.popupmenu_target_point,<span class="string">'String'</span>,target_names);  
1266     set(controls.popupmenu_through_point,<span class="string">'String'</span>,target_names); 
1267     
1268 <span class="keyword">end</span>
1269 controls.num_target_points=N;
1270 
1271 disp(<span class="string">'Loading program'</span>);
1272 program.n_lines=0;
1273 <span class="comment">%now load program</span>
1274 target_names=[];
1275 <span class="comment">%reset number of target points</span>
1276 N=0;
1277 <span class="comment">%now load target points</span>
1278 <span class="keyword">while</span> 1
1279     a = fgets(fp);
1280     <span class="keyword">if</span> length(a)&lt;=1
1281         <span class="keyword">continue</span>;
1282     <span class="keyword">end</span>
1283     
1284     k = strfind(a, <span class="string">'%ENDMODULE'</span>);
1285     <span class="comment">%test whether we reached the end of the program</span>
1286     <span class="keyword">if</span> k&gt;=0
1287         <span class="keyword">break</span>;
1288     <span class="keyword">end</span>
1289     
1290     <span class="comment">%test whether its a valid target point initialization in matlab</span>
1291     k = strfind(a, <span class="string">'('</span>);
1292     <span class="keyword">if</span> isempty(k)
1293         <span class="keyword">continue</span>;
1294     <span class="keyword">end</span>
1295 
1296     N = N+1;
1297     
1298     program.n_lines=N;
1299     program.matlab_lines{N}=a(1:end-1); <span class="comment">%remove carriage return</span>
1300     <span class="comment">%program.rapid_lines{N}=a;</span>
1301 <span class="keyword">end</span>
1302 
1303 fclose(fp);
1304 
1305 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
1306 
1307 
1308 <span class="comment">%Save the whole program to a .m file</span>
1309 <span class="comment">% --- Executes on button press in pushbutton_save.</span>
1310 <a name="_sub47" href="#_subfunctions" class="code">function pushbutton_save_Callback(hObject, eventdata, handles)</a>
1311 <span class="comment">% hObject    handle to pushbutton_save (see GCBO)</span>
1312 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1313 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1314 
1315 <span class="keyword">global</span> program controls targets
1316 
1317 <span class="comment">%always require a filename</span>
1318 [filename, pathname] = uiputfile(<span class="string">'*.m'</span>,<span class="string">'Save as .m'</span>);
1319 <span class="keyword">if</span> isequal(filename,0) || isequal(pathname,0)
1320    disp(<span class="string">'User selected Cancel'</span>)
1321    <span class="keyword">return</span>;
1322 <span class="keyword">else</span>
1323    disp([<span class="string">'User selected'</span>,fullfile(pathname,filename)])
1324 <span class="keyword">end</span>
1325 
1326 
1327 <span class="comment">%open selected file</span>
1328 fp=fopen(fullfile(pathname, filename),<span class="string">'w'</span>);
1329 
1330 disp(<span class="string">'Saving target points'</span>);
1331 
1332 fprintf(fp, <span class="string">'%%BEGINMODULE'</span>);
1333 <span class="comment">%write two escape characters to</span>
1334 fprintf(fp, <span class="string">'\n%%BEGINTARGETPOINTS'</span>);
1335 <span class="keyword">for</span> i=1:controls.num_target_points,
1336     tp = <a href="#_sub106" class="code" title="subfunction tp = construct_target(target_num)">construct_target</a>(i);
1337     ejes_ext = <span class="string">'[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];'</span>;
1338     a_rap = sprintf(<span class="string">'%s:=[[%.5f, %.5f, %.5f],[%.5f, %.5f, %.5f, %.5f], [%.5f, %.5f, %.5f, %.5f], %s'</span>,<span class="keyword">...</span>
1339     targets{i}.name, targets{i}.T(1,4),targets{i}.T(2,4),targets{i}.T(3,4),<span class="keyword">...</span>
1340             targets{i}.Q(1), targets{i}.Q(2), targets{i}.Q(3), targets{i}.Q(4),<span class="keyword">...</span>
1341         targets{i}.conf(1), targets{i}.conf(2), targets{i}.conf(3), targets{i}.conf(4), ejes_ext);
1342     a_mat = sprintf(<span class="string">'%s=[[%.5f, %.5f, %.5f],[%.5f, %.5f, %.5f, %.5f], [%.5f, %.5f, %.5f, %.5f], %s'</span>,<span class="keyword">...</span>
1343     targets{i}.name, targets{i}.T(1,4),targets{i}.T(2,4),targets{i}.T(3,4),<span class="keyword">...</span>
1344             targets{i}.Q(1), targets{i}.Q(2), targets{i}.Q(3), targets{i}.Q(4),<span class="keyword">...</span>
1345         targets{i}.conf(1), targets{i}.conf(2), targets{i}.conf(3), targets{i}.conf(4), ejes_ext);
1346     <span class="comment">%write file</span>
1347     <span class="comment">%fprintf(fp, '\n%%%s', a_rap);</span>
1348     fprintf(fp, <span class="string">'\n%s'</span>, a_mat);
1349 <span class="keyword">end</span>
1350 
1351 fprintf(fp, <span class="string">'\n%%ENDTARGETPOINTS\n'</span>);
1352 
1353 
1354 disp(<span class="string">'Saving program lines'</span>);
1355 <span class="keyword">for</span> i=1:program.n_lines,
1356     fprintf(fp, <span class="string">'\n%s'</span>, program.matlab_lines{i});
1357    <span class="comment">% fprintf(fp, '\n%%%s', program.rapid_lines{i});</span>
1358 <span class="keyword">end</span>
1359 
1360 fprintf(fp, <span class="string">'\n%%ENDMODULE\n'</span>);
1361 fclose(fp);
1362 
1363 
1364 <span class="comment">% simulate the whole program</span>
1365 <span class="comment">% --- Executes on button press in pushbutton_simulate.</span>
1366 <a name="_sub48" href="#_subfunctions" class="code">function pushbutton_simulate_Callback(hObject, eventdata, handles)</a>
1367 <span class="comment">% hObject    handle to pushbutton_simulate (see GCBO)</span>
1368 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1369 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1370 
1371 <span class="keyword">global</span> program targets controls robot
1372 
1373 <span class="comment">%reset position velocity acceleration and time</span>
1374 robot.q_vector=[];
1375 robot.qd_vector=[];
1376 robot.qdd_vector=[];
1377 robot.time=[];
1378 
1379 
1380 ejes_ext = <span class="string">'[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];'</span>;
1381 
1382 <span class="keyword">for</span> i=1:controls.num_target_points,
1383     a_mat = sprintf(<span class="string">'%s=[[%.5f, %.5f, %.5f],[%.5f, %.5f, %.5f, %.5f], [%.5f, %.5f, %.5f, %.5f], %s'</span>,<span class="keyword">...</span>
1384     targets{i}.name, targets{i}.T(1,4),targets{i}.T(2,4),targets{i}.T(3,4),<span class="keyword">...</span>
1385     targets{i}.Q(1), targets{i}.Q(2), targets{i}.Q(3), targets{i}.Q(4),<span class="keyword">...</span>
1386     targets{i}.conf(1), targets{i}.conf(2), targets{i}.conf(3), targets{i}.conf(4), ejes_ext);
1387     eval(a_mat);
1388 <span class="keyword">end</span>
1389 
1390 <span class="keyword">for</span> i=1:program.n_lines,
1391     eval(program.matlab_lines{i});
1392     <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
1393     <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
1394     <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
1395 <span class="keyword">end</span>
1396 
1397 robot.q_vector=[];
1398 robot.qd_vector=[];
1399 robot.qdd_vector=[];
1400 robot.time=[];
1401 
1402 
1403 
1404 <a name="_sub49" href="#_subfunctions" class="code">function edit_nx_Callback(hObject, eventdata, handles)</a>
1405 <span class="comment">% hObject    handle to edit_nx (see GCBO)</span>
1406 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1407 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1408 
1409 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_nx as text</span>
1410 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_nx as a double</span>
1411 
1412 
1413 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1414 <a name="_sub50" href="#_subfunctions" class="code">function edit_nx_CreateFcn(hObject, eventdata, handles)</a>
1415 <span class="comment">% hObject    handle to edit_nx (see GCBO)</span>
1416 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1417 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1418 <span class="keyword">global</span> controls
1419 controls.edit_nx=hObject;
1420 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1421 <span class="comment">%       See ISPC and COMPUTER.</span>
1422 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1423     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1424 <span class="keyword">end</span>
1425 
1426 
1427 
1428 <a name="_sub51" href="#_subfunctions" class="code">function edit_ox_Callback(hObject, eventdata, handles)</a>
1429 <span class="comment">% hObject    handle to edit_ox (see GCBO)</span>
1430 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1431 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1432 
1433 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_ox as text</span>
1434 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_ox as a double</span>
1435 
1436 
1437 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1438 <a name="_sub52" href="#_subfunctions" class="code">function edit_ox_CreateFcn(hObject, eventdata, handles)</a>
1439 <span class="comment">% hObject    handle to edit_ox (see GCBO)</span>
1440 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1441 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1442 <span class="keyword">global</span> controls
1443 controls.edit_ox=hObject;
1444 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1445 <span class="comment">%       See ISPC and COMPUTER.</span>
1446 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1447     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1448 <span class="keyword">end</span>
1449 
1450 
1451 
1452 <a name="_sub53" href="#_subfunctions" class="code">function edit_ax_Callback(hObject, eventdata, handles)</a>
1453 <span class="comment">% hObject    handle to edit_ax (see GCBO)</span>
1454 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1455 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1456 
1457 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_ax as text</span>
1458 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_ax as a double</span>
1459 
1460 
1461 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1462 <a name="_sub54" href="#_subfunctions" class="code">function edit_ax_CreateFcn(hObject, eventdata, handles)</a>
1463 <span class="comment">% hObject    handle to edit_ax (see GCBO)</span>
1464 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1465 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1466 <span class="keyword">global</span> controls
1467 controls.edit_ax=hObject;
1468 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1469 <span class="comment">%       See ISPC and COMPUTER.</span>
1470 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1471     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1472 <span class="keyword">end</span>
1473 
1474 
1475 
1476 <a name="_sub55" href="#_subfunctions" class="code">function edit_pxt_Callback(hObject, eventdata, handles)</a>
1477 <span class="comment">% hObject    handle to edit_pxt (see GCBO)</span>
1478 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1479 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1480 
1481 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_pxt as text</span>
1482 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_pxt as a double</span>
1483 
1484 
1485 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1486 <a name="_sub56" href="#_subfunctions" class="code">function edit_pxt_CreateFcn(hObject, eventdata, handles)</a>
1487 <span class="comment">% hObject    handle to edit_pxt (see GCBO)</span>
1488 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1489 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1490 <span class="keyword">global</span> controls
1491 controls.edit_pxt=hObject;
1492 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1493 <span class="comment">%       See ISPC and COMPUTER.</span>
1494 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1495     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1496 <span class="keyword">end</span>
1497 
1498 
1499 
1500 <a name="_sub57" href="#_subfunctions" class="code">function edit_ny_Callback(hObject, eventdata, handles)</a>
1501 <span class="comment">% hObject    handle to edit_ny (see GCBO)</span>
1502 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1503 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1504 
1505 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_ny as text</span>
1506 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_ny as a double</span>
1507 
1508 
1509 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1510 <a name="_sub58" href="#_subfunctions" class="code">function edit_ny_CreateFcn(hObject, eventdata, handles)</a>
1511 <span class="comment">% hObject    handle to edit_ny (see GCBO)</span>
1512 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1513 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1514 <span class="keyword">global</span> controls
1515 controls.edit_ny=hObject;
1516 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1517 <span class="comment">%       See ISPC and COMPUTER.</span>
1518 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1519     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1520 <span class="keyword">end</span>
1521 
1522 
1523 
1524 <a name="_sub59" href="#_subfunctions" class="code">function edit_oy_Callback(hObject, eventdata, handles)</a>
1525 <span class="comment">% hObject    handle to edit_oy (see GCBO)</span>
1526 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1527 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1528 
1529 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_oy as text</span>
1530 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_oy as a double</span>
1531 
1532 
1533 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1534 <a name="_sub60" href="#_subfunctions" class="code">function edit_oy_CreateFcn(hObject, eventdata, handles)</a>
1535 <span class="comment">% hObject    handle to edit_oy (see GCBO)</span>
1536 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1537 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1538 <span class="keyword">global</span> controls
1539 controls.edit_oy=hObject;
1540 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1541 <span class="comment">%       See ISPC and COMPUTER.</span>
1542 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1543     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1544 <span class="keyword">end</span>
1545 
1546 
1547 
1548 <a name="_sub61" href="#_subfunctions" class="code">function edit_ay_Callback(hObject, eventdata, handles)</a>
1549 <span class="comment">% hObject    handle to edit_ay (see GCBO)</span>
1550 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1551 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1552 
1553 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_ay as text</span>
1554 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_ay as a double</span>
1555 
1556 
1557 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1558 <a name="_sub62" href="#_subfunctions" class="code">function edit_ay_CreateFcn(hObject, eventdata, handles)</a>
1559 <span class="comment">% hObject    handle to edit_ay (see GCBO)</span>
1560 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1561 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1562 <span class="keyword">global</span> controls
1563 controls.edit_ay=hObject;
1564 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1565 <span class="comment">%       See ISPC and COMPUTER.</span>
1566 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1567     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1568 <span class="keyword">end</span>
1569 
1570 
1571 
1572 <a name="_sub63" href="#_subfunctions" class="code">function edit_pyt_Callback(hObject, eventdata, handles)</a>
1573 <span class="comment">% hObject    handle to edit_pyt (see GCBO)</span>
1574 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1575 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1576 
1577 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_pyt as text</span>
1578 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_pyt as a double</span>
1579 
1580 
1581 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1582 <a name="_sub64" href="#_subfunctions" class="code">function edit_pyt_CreateFcn(hObject, eventdata, handles)</a>
1583 <span class="comment">% hObject    handle to edit_pyt (see GCBO)</span>
1584 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1585 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1586 <span class="keyword">global</span> controls
1587 controls.edit_pyt=hObject;
1588 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1589 <span class="comment">%       See ISPC and COMPUTER.</span>
1590 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1591     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1592 <span class="keyword">end</span>
1593 
1594 
1595 
1596 <a name="_sub65" href="#_subfunctions" class="code">function edit_nz_Callback(hObject, eventdata, handles)</a>
1597 <span class="comment">% hObject    handle to edit_nz (see GCBO)</span>
1598 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1599 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1600 
1601 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_nz as text</span>
1602 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_nz as a double</span>
1603 
1604 
1605 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1606 <a name="_sub66" href="#_subfunctions" class="code">function edit_nz_CreateFcn(hObject, eventdata, handles)</a>
1607 <span class="comment">% hObject    handle to edit_nz (see GCBO)</span>
1608 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1609 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1610 <span class="keyword">global</span> controls
1611 controls.edit_nz=hObject;
1612 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1613 <span class="comment">%       See ISPC and COMPUTER.</span>
1614 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1615     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1616 <span class="keyword">end</span>
1617 
1618 
1619 
1620 <a name="_sub67" href="#_subfunctions" class="code">function edit_oz_Callback(hObject, eventdata, handles)</a>
1621 <span class="comment">% hObject    handle to edit_oz (see GCBO)</span>
1622 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1623 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1624 
1625 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_oz as text</span>
1626 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_oz as a double</span>
1627 
1628 
1629 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1630 <a name="_sub68" href="#_subfunctions" class="code">function edit_oz_CreateFcn(hObject, eventdata, handles)</a>
1631 <span class="comment">% hObject    handle to edit_oz (see GCBO)</span>
1632 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1633 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1634 <span class="keyword">global</span> controls
1635 controls.edit_oz=hObject;
1636 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1637 <span class="comment">%       See ISPC and COMPUTER.</span>
1638 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1639     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1640 <span class="keyword">end</span>
1641 
1642 
1643 
1644 <a name="_sub69" href="#_subfunctions" class="code">function edit_az_Callback(hObject, eventdata, handles)</a>
1645 <span class="comment">% hObject    handle to edit_az (see GCBO)</span>
1646 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1647 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1648 
1649 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_az as text</span>
1650 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_az as a double</span>
1651 
1652 
1653 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1654 <a name="_sub70" href="#_subfunctions" class="code">function edit_az_CreateFcn(hObject, eventdata, handles)</a>
1655 <span class="comment">% hObject    handle to edit_az (see GCBO)</span>
1656 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1657 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1658 <span class="keyword">global</span> controls
1659 controls.edit_az=hObject;
1660 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1661 <span class="comment">%       See ISPC and COMPUTER.</span>
1662 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1663     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1664 <span class="keyword">end</span>
1665 
1666 
1667 
1668 <a name="_sub71" href="#_subfunctions" class="code">function edit_pzt_Callback(hObject, eventdata, handles)</a>
1669 <span class="comment">% hObject    handle to edit_pzt (see GCBO)</span>
1670 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1671 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1672 
1673 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_pzt as text</span>
1674 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_pzt as a double</span>
1675 
1676 
1677 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1678 <a name="_sub72" href="#_subfunctions" class="code">function edit_pzt_CreateFcn(hObject, eventdata, handles)</a>
1679 <span class="comment">% hObject    handle to edit_pzt (see GCBO)</span>
1680 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1681 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1682 <span class="keyword">global</span> controls
1683 controls.edit_pzt=hObject;
1684 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1685 <span class="comment">%       See ISPC and COMPUTER.</span>
1686 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1687     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1688 <span class="keyword">end</span>
1689 
1690 
1691 <span class="comment">% SOLVE THE INVERSE KINEMATIC PROBLEM AND GO TO IT</span>
1692 <span class="comment">%   THE CLOSEST CONFIGURATION IS ALWAYS FOUND IN THE JOINT SPACE</span>
1693 <span class="comment">% --- Executes on button press in pushbutton_moveT.</span>
1694 <a name="_sub73" href="#_subfunctions" class="code">function pushbutton_moveT_Callback(hObject, eventdata, handles)</a>
1695 <span class="comment">% hObject    handle to pushbutton_moveT (see GCBO)</span>
1696 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1697 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1698 
1699 
1700 <span class="keyword">global</span> robot controls configuration
1701 
1702 <span class="comment">%get values of T from dialog</span>
1703 [T,Q,P]=<a href="#_sub100" class="code" title="subfunction [T,Q,P]=get_TQ_from_dialog()">get_TQ_from_dialog</a>();
1704 
1705 <span class="comment">%several solutions are provided</span>
1706 qinv = <a href="../../arte3.1.4/lib/kinematics/inversekinematic.html" class="code" title="function q = inversekinematic(robot, T)">inversekinematic</a>(robot, T);
1707 
1708 distance_joint=[];
1709 <span class="keyword">for</span> i=1:size(qinv,2),
1710    distance_joint(i)=sum(abs(qinv(:,i)-robot.q)); 
1711 <span class="keyword">end</span>
1712 [val,i]=min(distance_joint);
1713 
1714 q_current=robot.q;
1715 q_final = qinv(:,i);
1716 
1717 path = <a href="#_sub102" class="code" title="subfunction path=lineal_path_plan(q_ini, q_final)">lineal_path_plan</a>(q_current, q_final);
1718 
1719 robot.q_vector=path;
1720 <span class="comment">%Test whether there are joints outside mechanical limits</span>
1721 <a href="../../arte3.1.4/RAPID/functions/test_joint_limits.html" class="code" title="function [joint, time] = test_joint_limits(robot)">test_joint_limits</a>(robot);
1722 
1723 <span class="comment">%do not move if current and final coordinates are the same</span>
1724 <span class="keyword">for</span> i=1:size(path,2),
1725    <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, path(:,i)); 
1726    pause(configuration.time_delay);  
1727 <span class="keyword">end</span>
1728 
1729 robot.q=q_final;
1730 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
1731 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
1732 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>()
1733 
1734 <a name="_sub74" href="#_subfunctions" class="code">function edit_Q0_Callback(hObject, eventdata, handles)</a>
1735 <span class="comment">% hObject    handle to edit_Q0 (see GCBO)</span>
1736 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1737 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1738 
1739 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_Q0 as text</span>
1740 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_Q0 as a double</span>
1741 
1742 
1743 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1744 <a name="_sub75" href="#_subfunctions" class="code">function edit_Q0_CreateFcn(hObject, eventdata, handles)</a>
1745 <span class="comment">% hObject    handle to edit_Q0 (see GCBO)</span>
1746 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1747 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1748 <span class="keyword">global</span> controls
1749 controls.edit_Q0=hObject;
1750 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1751 <span class="comment">%       See ISPC and COMPUTER.</span>
1752 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1753     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1754 <span class="keyword">end</span>
1755 
1756 
1757 
1758 <a name="_sub76" href="#_subfunctions" class="code">function edit_Q1_Callback(hObject, eventdata, handles)</a>
1759 <span class="comment">% hObject    handle to edit_Q1 (see GCBO)</span>
1760 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1761 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1762 
1763 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_Q1 as text</span>
1764 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_Q1 as a double</span>
1765 
1766 
1767 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1768 <a name="_sub77" href="#_subfunctions" class="code">function edit_Q1_CreateFcn(hObject, eventdata, handles)</a>
1769 <span class="comment">% hObject    handle to edit_Q1 (see GCBO)</span>
1770 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1771 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1772 <span class="keyword">global</span> controls
1773 controls.edit_Q1=hObject;
1774 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1775 <span class="comment">%       See ISPC and COMPUTER.</span>
1776 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1777     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1778 <span class="keyword">end</span>
1779 
1780 
1781 
1782 <a name="_sub78" href="#_subfunctions" class="code">function edit_Q2_Callback(hObject, eventdata, handles)</a>
1783 <span class="comment">% hObject    handle to edit_Q2 (see GCBO)</span>
1784 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1785 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1786 
1787 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_Q2 as text</span>
1788 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_Q2 as a double</span>
1789 
1790 
1791 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1792 <a name="_sub79" href="#_subfunctions" class="code">function edit_Q2_CreateFcn(hObject, eventdata, handles)</a>
1793 <span class="comment">% hObject    handle to edit_Q2 (see GCBO)</span>
1794 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1795 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1796 <span class="keyword">global</span> controls
1797 controls.edit_Q2=hObject;
1798 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1799 <span class="comment">%       See ISPC and COMPUTER.</span>
1800 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1801     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1802 <span class="keyword">end</span>
1803 
1804 
1805 
1806 <a name="_sub80" href="#_subfunctions" class="code">function edit_Q3_Callback(hObject, eventdata, handles)</a>
1807 <span class="comment">% hObject    handle to edit_Q3 (see GCBO)</span>
1808 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1809 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1810 
1811 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_Q3 as text</span>
1812 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_Q3 as a double</span>
1813 
1814 
1815 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1816 <a name="_sub81" href="#_subfunctions" class="code">function edit_Q3_CreateFcn(hObject, eventdata, handles)</a>
1817 <span class="comment">% hObject    handle to edit_Q3 (see GCBO)</span>
1818 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1819 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1820 <span class="keyword">global</span> controls
1821 controls.edit_Q3=hObject;
1822 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1823 <span class="comment">%       See ISPC and COMPUTER.</span>
1824 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1825     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1826 <span class="keyword">end</span>
1827 
1828 
1829 
1830 <a name="_sub82" href="#_subfunctions" class="code">function edit_pxq_Callback(hObject, eventdata, handles)</a>
1831 <span class="comment">% hObject    handle to edit_pxq (see GCBO)</span>
1832 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1833 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1834 
1835 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_pxq as text</span>
1836 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_pxq as a double</span>
1837 
1838 
1839 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1840 <a name="_sub83" href="#_subfunctions" class="code">function edit_pxq_CreateFcn(hObject, eventdata, handles)</a>
1841 <span class="comment">% hObject    handle to edit_pxq (see GCBO)</span>
1842 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1843 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1844 <span class="keyword">global</span> controls
1845 controls.edit_pxq=hObject;
1846 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1847 <span class="comment">%       See ISPC and COMPUTER.</span>
1848 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1849     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1850 <span class="keyword">end</span>
1851 
1852 
1853 
1854 <a name="_sub84" href="#_subfunctions" class="code">function edit_pyq_Callback(hObject, eventdata, handles)</a>
1855 <span class="comment">% hObject    handle to edit_pyq (see GCBO)</span>
1856 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1857 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1858 
1859 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_pyq as text</span>
1860 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_pyq as a double</span>
1861 
1862 
1863 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1864 <a name="_sub85" href="#_subfunctions" class="code">function edit_pyq_CreateFcn(hObject, eventdata, handles)</a>
1865 <span class="comment">% hObject    handle to edit_pyq (see GCBO)</span>
1866 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1867 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1868 <span class="keyword">global</span> controls
1869 controls.edit_pyq=hObject;
1870 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1871 <span class="comment">%       See ISPC and COMPUTER.</span>
1872 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1873     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1874 <span class="keyword">end</span>
1875 
1876 
1877 
1878 <a name="_sub86" href="#_subfunctions" class="code">function edit_pzq_Callback(hObject, eventdata, handles)</a>
1879 <span class="comment">% hObject    handle to edit_pzq (see GCBO)</span>
1880 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1881 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1882 
1883 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_pzq as text</span>
1884 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_pzq as a double</span>
1885 
1886 
1887 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
1888 <a name="_sub87" href="#_subfunctions" class="code">function edit_pzq_CreateFcn(hObject, eventdata, handles)</a>
1889 <span class="comment">% hObject    handle to edit_pzq (see GCBO)</span>
1890 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1891 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
1892 <span class="keyword">global</span> controls
1893 controls.edit_pzq=hObject;
1894 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
1895 <span class="comment">%       See ISPC and COMPUTER.</span>
1896 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
1897     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
1898 <span class="keyword">end</span>
1899 
1900 
1901 
1902 <span class="comment">%when pressed, OBTAIN Q from dialog, convert to homogeneous matrix and</span>
1903 <span class="comment">%plan a coordinated path to it</span>
1904 <span class="comment">% --- Executes on button press in pushbutton_moveQ.</span>
1905 <a name="_sub88" href="#_subfunctions" class="code">function pushbutton_moveQ_Callback(hObject, eventdata, handles)</a>
1906 <span class="comment">% hObject    handle to pushbutton_moveQ (see GCBO)</span>
1907 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1908 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1909 
1910 
1911 <span class="keyword">global</span> robot controls configuration
1912 
1913 <span class="comment">%get values of T from dialog</span>
1914 [T,Q,P]=<a href="#_sub100" class="code" title="subfunction [T,Q,P]=get_TQ_from_dialog()">get_TQ_from_dialog</a>();
1915 
1916 <span class="comment">%convert quaternion to orientation</span>
1917 T = <a href="../../arte3.1.4/lib/quaternion2T.html" class="code" title="function T = quaternion2T(Q, P)">quaternion2T</a>(Q);
1918 
1919 T(1,4)=P(1);
1920 T(2,4)=P(2);
1921 T(3,4)=P(3);
1922 
1923 <span class="comment">%several solutions are provided</span>
1924 qinv = <a href="../../arte3.1.4/lib/kinematics/inversekinematic.html" class="code" title="function q = inversekinematic(robot, T)">inversekinematic</a>(robot, T);
1925 
1926 distance_joint=[];
1927 <span class="keyword">for</span> i=1:size(qinv,2),
1928    distance_joint(i)=sum(abs(qinv(:,i)-robot.q)); 
1929 <span class="keyword">end</span>
1930 [val,i]=min(distance_joint);
1931 
1932 q_current=robot.q;
1933 q_final = qinv(:,i);
1934 
1935 path = <a href="#_sub102" class="code" title="subfunction path=lineal_path_plan(q_ini, q_final)">lineal_path_plan</a>(q_current, q_final);
1936 
1937 robot.q_vector=path;
1938 <span class="comment">%Test whether there are joints outside mechanical limits</span>
1939 <a href="../../arte3.1.4/RAPID/functions/test_joint_limits.html" class="code" title="function [joint, time] = test_joint_limits(robot)">test_joint_limits</a>(robot);
1940 
1941 <span class="comment">%do not move if current and final coordinates are the same</span>
1942 <span class="keyword">for</span> i=1:size(path,2),
1943     <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, path(:,i)); 
1944     pause(configuration.time_delay);  
1945 <span class="keyword">end</span>
1946 
1947 robot.q=q_final;
1948 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
1949 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
1950 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>()
1951 
1952 
1953 
1954 <span class="comment">%save a target point to memory</span>
1955 <span class="comment">% --- Executes on button press in pushbutton_save_target_point.</span>
1956 <a name="_sub89" href="#_subfunctions" class="code">function pushbutton_save_target_point_Callback(hObject, eventdata, handles)</a>
1957 <span class="comment">% hObject    handle to pushbutton_save_target_point (see GCBO)</span>
1958 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1959 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1960 <span class="keyword">global</span> controls robot targets
1961 
1962 target_point_name = get(controls.edit_target_point,<span class="string">'String'</span>);
1963 
1964 <span class="comment">%add a target point</span>
1965 controls.num_target_points = controls.num_target_points+1;
1966 
1967 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
1968 
1969 <span class="comment">%convert to quaternion</span>
1970 Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T);
1971 Q=real(Q);
1972 target.T = T;
1973 target.Q = Q;
1974 target.q = robot.q;<span class="comment">%store the current coordinates</span>
1975 target.conf = <a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);
1976 target.name = target_point_name;
1977 
1978 
1979 targets{controls.num_target_points}=target;
1980 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
1981 
1982 s0=get(controls.popupmenu_target_point,<span class="string">'String'</span>);
1983 a=length(s0);
1984 s0{a+1}=target_point_name;
1985 
1986 <span class="comment">%store the name in the programming popup storing the available targets.</span>
1987 set(controls.popupmenu_target_point,<span class="string">'String'</span>,s0);
1988 
1989 
1990 <span class="comment">%the through point popupmenu</span>
1991 s0=get(controls.popupmenu_through_point,<span class="string">'String'</span>);
1992 a=length(s0);
1993 s0{a+1}=target_point_name;
1994 
1995 <span class="comment">%store the name in the programming popup storing the available targets.</span>
1996 set(controls.popupmenu_through_point,<span class="string">'String'</span>,s0);
1997 
1998 
1999 
2000 <a name="_sub90" href="#_subfunctions" class="code">function edit_target_point_Callback(hObject, eventdata, handles)</a>
2001 <span class="comment">% hObject    handle to edit_target_point (see GCBO)</span>
2002 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2003 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2004 
2005 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_target_point as text</span>
2006 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_target_point as a double</span>
2007 
2008 
2009 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
2010 <a name="_sub91" href="#_subfunctions" class="code">function edit_target_point_CreateFcn(hObject, eventdata, handles)</a>
2011 <span class="comment">% hObject    handle to edit_target_point (see GCBO)</span>
2012 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2013 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
2014 <span class="keyword">global</span> controls
2015 controls.edit_target_point = hObject;
2016 
2017 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
2018 <span class="comment">%       See ISPC and COMPUTER.</span>
2019 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
2020     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
2021 <span class="keyword">end</span>
2022 
2023 
2024 <span class="comment">% --- Executes on selection change in popupmenu6.</span>
2025 <a name="_sub92" href="#_subfunctions" class="code">function popupmenu6_Callback(hObject, eventdata, handles)</a>
2026 <span class="comment">% hObject    handle to popupmenu6 (see GCBO)</span>
2027 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2028 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2029 
2030 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu6 contents as cell array</span>
2031 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu6</span>
2032 
2033 
2034 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
2035 <a name="_sub93" href="#_subfunctions" class="code">function popupmenu6_CreateFcn(hObject, eventdata, handles)</a>
2036 <span class="comment">% hObject    handle to popupmenu6 (see GCBO)</span>
2037 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2038 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
2039 
2040 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
2041 <span class="comment">%       See ISPC and COMPUTER.</span>
2042 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
2043     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
2044 <span class="keyword">end</span>
2045 
2046 
2047 <span class="comment">% --- Executes on button press in pushbutton_simulate_instruction.</span>
2048 <a name="_sub94" href="#_subfunctions" class="code">function pushbutton_simulate_instruction_Callback(hObject, eventdata, handles)</a>
2049 <span class="comment">% hObject    handle to pushbutton_simulate_instruction (see GCBO)</span>
2050 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2051 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2052 
2053 <span class="keyword">global</span> controls targets robot
2054 
2055 <span class="comment">%reset position velocity acceleration and time</span>
2056 robot.q_vector=[];
2057 robot.qd_vector=[];
2058 robot.qdd_vector=[];
2059 robot.time=[];
2060 
2061 tool0=[];
2062 wobj0=[];
2063 
2064 [instruction_matlab, instruction_rapid, tp1, tp2, joint_coord]=<a href="#_sub108" class="code" title="subfunction [instruction_matlab, instruction_rapid, tp1, tp2, joint_coord]=build_instruction_to_eval()">build_instruction_to_eval</a>(); 
2065 eval(instruction_matlab);
2066 <span class="comment">% s = get(controls.popupmenu_instruction,'String');</span>
2067 <span class="comment">% i = get(controls.popupmenu_instruction,'Value');</span>
2068 <span class="comment">% s1=s{i};</span>
2069 <span class="comment">%</span>
2070 <span class="comment">% switch s1</span>
2071 <span class="comment">%     case {'MoveJ','MoveL'}</span>
2072 <span class="comment">%</span>
2073 <span class="comment">%         s = get(controls.popupmenu_target_point,'String');</span>
2074 <span class="comment">%         target_num = get(controls.popupmenu_target_point,'Value');</span>
2075 <span class="comment">%         s2=s{target_num};</span>
2076 <span class="comment">%</span>
2077 <span class="comment">%         s = get(controls.popupmenu_speed,'String');</span>
2078 <span class="comment">%         i = get(controls.popupmenu_speed,'Value');</span>
2079 <span class="comment">%         s3=s{i};</span>
2080 <span class="comment">%</span>
2081 <span class="comment">%         s = get(controls.popupmenu_precision,'String');</span>
2082 <span class="comment">%         i = get(controls.popupmenu_precision,'Value');</span>
2083 <span class="comment">%         s4=s{i};</span>
2084 <span class="comment">%</span>
2085 <span class="comment">%         instruction_rapid = [s1 ' ' s2 ',' s3 ',' s4 ',tool0\Wobj:=wobj0;'];</span>
2086 <span class="comment">%</span>
2087 <span class="comment">%         tp=construct_target(target_num);</span>
2088 <span class="comment">%</span>
2089 <span class="comment">%         instruction_matlab = ['robot=' s1 '(robot, tp, s3, s4, tool0, wobj0);'];</span>
2090 <span class="comment">%         fprintf('\n**********************************************\n');</span>
2091 <span class="comment">%         fprintf('Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n', instruction_rapid, instruction_matlab);</span>
2092 <span class="comment">%         fprintf('**********************************************\n');</span>
2093 <span class="comment">%</span>
2094 <span class="comment">%         eval(instruction_matlab);</span>
2095 <span class="comment">%</span>
2096 <span class="comment">%      case 'MoveAbsJ'</span>
2097 <span class="comment">%</span>
2098 <span class="comment">%         s = get(controls.popupmenu_target_point,'String');</span>
2099 <span class="comment">%         target_num = get(controls.popupmenu_target_point,'Value');</span>
2100 <span class="comment">%         s2=s{target_num};</span>
2101 <span class="comment">%</span>
2102 <span class="comment">%         s = get(controls.popupmenu_speed,'String');</span>
2103 <span class="comment">%         i = get(controls.popupmenu_speed,'Value');</span>
2104 <span class="comment">%         s3=s{i};</span>
2105 <span class="comment">%</span>
2106 <span class="comment">%         s = get(controls.popupmenu_precision,'String');</span>
2107 <span class="comment">%         i = get(controls.popupmenu_precision,'Value');</span>
2108 <span class="comment">%         s4=s{i};</span>
2109 <span class="comment">%</span>
2110 <span class="comment">%         instruction_rapid = [s1 ' ' s2 ',' s3 ',' s4 ',tool0\Wobj:=wobj0;'];</span>
2111 <span class="comment">%</span>
2112 <span class="comment">%</span>
2113 <span class="comment">%         joint_coord=[targets{target_num}.q' 1e9, 1e9, 1e9, 1e9, 1e9, 1e9];</span>
2114 <span class="comment">%</span>
2115 <span class="comment">%         instruction_matlab = ['robot=' s1 '(robot, joint_coord, s3, s4, tool0, wobj0);'];</span>
2116 <span class="comment">%         fprintf('\n**********************************************\n');</span>
2117 <span class="comment">%         fprintf('Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n', instruction_rapid, instruction_matlab);</span>
2118 <span class="comment">%         fprintf('**********************************************\n');</span>
2119 <span class="comment">%</span>
2120 <span class="comment">%         eval(instruction_matlab);</span>
2121 <span class="comment">%</span>
2122 <span class="comment">%</span>
2123 <span class="comment">%     case 'MoveC'</span>
2124 <span class="comment">%         s = get(controls.popupmenu_target_point,'String');</span>
2125 <span class="comment">%         target_num1 = get(controls.popupmenu_target_point,'Value');</span>
2126 <span class="comment">%         s2=s{target_num1};</span>
2127 <span class="comment">%</span>
2128 <span class="comment">%         s = get(controls.popupmenu_through_point,'String');</span>
2129 <span class="comment">%         target_num2 = get(controls.popupmenu_through_point,'Value');</span>
2130 <span class="comment">%         s3=s{target_num2};</span>
2131 <span class="comment">%</span>
2132 <span class="comment">%         s = get(controls.popupmenu_speed,'String');</span>
2133 <span class="comment">%         i = get(controls.popupmenu_speed,'Value');</span>
2134 <span class="comment">%         vel=s{i};</span>
2135 <span class="comment">%</span>
2136 <span class="comment">%         s = get(controls.popupmenu_precision,'String');</span>
2137 <span class="comment">%         i = get(controls.popupmenu_precision,'Value');</span>
2138 <span class="comment">%         prec=s{i};</span>
2139 <span class="comment">%</span>
2140 <span class="comment">%         instruction_rapid = [s1 ' ' s3 ',' s2 ',' vel ',' prec  ',tool0\Wobj:=wobj0;'];</span>
2141 <span class="comment">%</span>
2142 <span class="comment">%         tp2=construct_target(target_num1);</span>
2143 <span class="comment">%         tp1=construct_target(target_num2);%the through point</span>
2144 <span class="comment">%</span>
2145 <span class="comment">%         instruction_matlab = ['robot=' s1 '(robot, tp1, tp2, vel , prec);'];</span>
2146 <span class="comment">%         fprintf('\n**********************************************\n');</span>
2147 <span class="comment">%         fprintf('Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n', instruction_rapid, instruction_matlab);</span>
2148 <span class="comment">%         fprintf('**********************************************\n');</span>
2149 <span class="comment">%</span>
2150 <span class="comment">%         eval(instruction_matlab);</span>
2151 <span class="comment">%</span>
2152 <span class="comment">%     otherwise disp('RAPID instruction not supported');</span>
2153 <span class="comment">% end</span>
2154 
2155 <span class="comment">%reset position velocity acceleration and time</span>
2156 robot.q_vector=[];
2157 robot.qd_vector=[];
2158 robot.qdd_vector=[];
2159 robot.time=[];
2160 
2161 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
2162 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
2163 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
2164 
2165 <span class="comment">%clf(controls.global_gui_handle)</span>
2166 <span class="comment">%drawnow()</span>
2167 
2168 
2169 <span class="comment">% --- Executes on button press in pushbutton_save_instruction.</span>
2170 <a name="_sub95" href="#_subfunctions" class="code">function pushbutton_save_instruction_Callback(hObject, eventdata, handles)</a>
2171 <span class="comment">% hObject    handle to pushbutton_save_instruction (see GCBO)</span>
2172 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2173 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2174 
2175 <span class="keyword">global</span> controls targets robot program
2176 
2177 <span class="comment">% %Get instruction name</span>
2178 <span class="comment">% instruction = [];</span>
2179 <span class="comment">%</span>
2180 <span class="comment">% s = get(controls.popupmenu_instruction,'String');</span>
2181 <span class="comment">% i = get(controls.popupmenu_instruction,'Value');</span>
2182 <span class="comment">% s1=s{i};</span>
2183 <span class="comment">%</span>
2184 <span class="comment">% s = get(controls.popupmenu_target_point,'String');</span>
2185 <span class="comment">% target_num = get(controls.popupmenu_target_point,'Value');</span>
2186 <span class="comment">% s2=s{target_num};</span>
2187 <span class="comment">%</span>
2188 <span class="comment">% s = get(controls.popupmenu_speed,'String');</span>
2189 <span class="comment">% i = get(controls.popupmenu_speed,'Value');</span>
2190 <span class="comment">% s3=s{i};</span>
2191 <span class="comment">%</span>
2192 <span class="comment">% s = get(controls.popupmenu_precision,'String');</span>
2193 <span class="comment">% i = get(controls.popupmenu_precision,'Value');</span>
2194 <span class="comment">% s4=s{i};</span>
2195 
2196 
2197 [instruction_matlab, instruction_rapid]=<a href="#_sub109" class="code" title="subfunction [instruction_matlab, instruction_rapid]=build_instruction_to_save()">build_instruction_to_save</a>(); 
2198 
2199 
2200 <span class="comment">%program.program_counter = program.program_counter + 1;</span>
2201 program.n_lines = program.n_lines + 1;
2202 
2203 program.rapid_lines{program.n_lines} = instruction_rapid;<span class="comment">%[s1 ' ' s2 ',' s3 ',' s4 ',tool0\Wobj:=wobj0;'];</span>
2204 program.matlab_lines{program.n_lines} = instruction_matlab;<span class="comment">%['robot=' s1 '(robot,' s2 ',' sprintf('''%s''', s3) ',' sprintf('''%s''', s4) ');'];</span>
2205 
2206 
2207 fprintf(<span class="string">'\n**********************************************\n'</span>);
2208 fprintf(<span class="string">'Adding instruction to program.\nCurrent program:'</span>);
2209 fprintf(<span class="string">'\n**********************************************\n'</span>);
2210 <span class="keyword">for</span> i=1:program.n_lines,
2211     fprintf(<span class="string">'\n%s'</span>, program.rapid_lines{i});
2212 <span class="keyword">end</span>
2213 fprintf(<span class="string">'\n**********************************************\n'</span>);
2214 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
2215 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
2216 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>()
2217 
2218 
2219 
2220 
2221 
2222 <span class="comment">% --- Executes on key press with focus on slider_q1 and none of its controls.</span>
2223 <a name="_sub96" href="#_subfunctions" class="code">function slider_q1_KeyPressFcn(hObject, eventdata, handles)</a>
2224 <span class="comment">% hObject    handle to slider_q1 (see GCBO)</span>
2225 <span class="comment">% eventdata  structure with the following fields (see UICONTROL)</span>
2226 <span class="comment">%    Key: name of the key that was pressed, in lower case</span>
2227 <span class="comment">%    Character: character interpretation of the key(s) that was pressed</span>
2228 <span class="comment">%    Modifier: name(s) of the modifier key(s) (i.e., control, shift) pressed</span>
2229 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2230 
2231 
2232 
2233 
2234 <span class="comment">% --- Executes on selection change in popupmenu_base_end.</span>
2235 <a name="_sub97" href="#_subfunctions" class="code">function popupmenu_base_end_Callback(hObject, eventdata, handles)</a>
2236 <span class="comment">% hObject    handle to popupmenu_base_end (see GCBO)</span>
2237 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2238 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2239 
2240 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu_base_end contents as cell array</span>
2241 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_base_end</span>
2242 
2243 
2244 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
2245 <a name="_sub98" href="#_subfunctions" class="code">function popupmenu_base_end_CreateFcn(hObject, eventdata, handles)</a>
2246 <span class="comment">% hObject    handle to popupmenu_base_end (see GCBO)</span>
2247 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2248 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
2249 
2250 <span class="keyword">global</span> controls
2251 controls.popupmenu_base_end=hObject;
2252 
2253 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
2254 <span class="comment">%       See ISPC and COMPUTER.</span>
2255 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
2256     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
2257 <span class="keyword">end</span>
2258 
2259 
2260 
2261 
2262 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2263 <span class="comment">%   REST OF FUNCTIONS TO HELP DIALOGS</span>
2264 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2265 
2266 <span class="comment">%update the values from T to the dialog</span>
2267 <a name="_sub99" href="#_subfunctions" class="code">function update_T_Q()</a>
2268 
2269 <span class="keyword">global</span> robot controls
2270 
2271 
2272 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
2273 
2274 <span class="comment">%Update T</span>
2275 set(controls.edit_nx, <span class="string">'String'</span>, num2str(T(1,1), <span class="string">'%.3f'</span>));
2276 set(controls.edit_ny, <span class="string">'String'</span>, num2str(T(2,1), <span class="string">'%.3f'</span>));
2277 set(controls.edit_nz, <span class="string">'String'</span>, num2str(T(3,1), <span class="string">'%.3f'</span>));
2278 set(controls.edit_ox, <span class="string">'String'</span>, num2str(T(1,2), <span class="string">'%.3f'</span>));
2279 set(controls.edit_oy, <span class="string">'String'</span>, num2str(T(2,2), <span class="string">'%.3f'</span>));
2280 set(controls.edit_oz, <span class="string">'String'</span>, num2str(T(3,2), <span class="string">'%.3f'</span>));
2281 set(controls.edit_ax, <span class="string">'String'</span>, num2str(T(1,3), <span class="string">'%.3f'</span>));
2282 set(controls.edit_ay, <span class="string">'String'</span>, num2str(T(2,3), <span class="string">'%.3f'</span>));
2283 set(controls.edit_az, <span class="string">'String'</span>, num2str(T(3,3), <span class="string">'%.3f'</span>));
2284 set(controls.edit_pxt, <span class="string">'String'</span>, num2str(T(1,4), <span class="string">'%.3f'</span>));
2285 set(controls.edit_pyt, <span class="string">'String'</span>, num2str(T(2,4), <span class="string">'%.3f'</span>));
2286 set(controls.edit_pzt, <span class="string">'String'</span>, num2str(T(3,4), <span class="string">'%.3f'</span>));
2287 
2288 <span class="comment">%convert T to quaternion</span>
2289 Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T);
2290 Q=real(Q);
2291 set(controls.edit_Q0, <span class="string">'String'</span>, num2str(Q(1),<span class="string">'%.3f'</span>));
2292 set(controls.edit_Q1, <span class="string">'String'</span>, num2str(Q(2), <span class="string">'%.3f'</span>));
2293 set(controls.edit_Q2, <span class="string">'String'</span>, num2str(Q(3), <span class="string">'%.3f'</span>));
2294 set(controls.edit_Q3, <span class="string">'String'</span>, num2str(Q(4), <span class="string">'%.3f'</span>));
2295 <span class="comment">%the same position as in T</span>
2296 set(controls.edit_pxq, <span class="string">'String'</span>, num2str(T(1,4), <span class="string">'%.3f'</span>));
2297 set(controls.edit_pyq, <span class="string">'String'</span>, num2str(T(2,4), <span class="string">'%.3f'</span>));
2298 set(controls.edit_pzq, <span class="string">'String'</span>, num2str(T(3,4), <span class="string">'%.3f'</span>));
2299 
2300 
2301 <span class="comment">%obtain the values of T Q and posittion from</span>
2302 <a name="_sub100" href="#_subfunctions" class="code">function [T,Q,P]=get_TQ_from_dialog()</a>
2303 
2304 <span class="keyword">global</span> robot controls
2305 
2306 
2307 T = eye(4);
2308 
2309 <span class="comment">%Update T</span>
2310 T(1,1)=sscanf(get(controls.edit_nx, <span class="string">'String'</span>),<span class="string">'%f'</span>);
2311 T(2,1)=sscanf(get(controls.edit_ny, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2312 T(3,1)=sscanf(get(controls.edit_nz, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2313 T(1,2)=sscanf(get(controls.edit_ox, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2314 T(2,2)=sscanf(get(controls.edit_oy, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2315 T(3,2)=sscanf(get(controls.edit_oz, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2316 T(1,3)=sscanf(get(controls.edit_ax, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2317 T(2,3)=sscanf(get(controls.edit_ay, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2318 T(3,3)=sscanf(get(controls.edit_az, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2319 T(1,4)=sscanf(get(controls.edit_pxt, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2320 T(2,4)=sscanf(get(controls.edit_pyt, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2321 T(3,4)=sscanf(get(controls.edit_pzt, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2322  
2323 Q = zeros(1,4);
2324 Q(1)=sscanf(get(controls.edit_Q0, <span class="string">'String'</span>),<span class="string">'%f'</span>);
2325 Q(2)=sscanf(get(controls.edit_Q1, <span class="string">'String'</span>),<span class="string">'%f'</span>);
2326 Q(3)=sscanf(get(controls.edit_Q2, <span class="string">'String'</span>),<span class="string">'%f'</span>);
2327 Q(4)=sscanf(get(controls.edit_Q3, <span class="string">'String'</span>),<span class="string">'%f'</span>);
2328 
2329 P(1)=sscanf(get(controls.edit_pxq, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2330 P(2)=sscanf(get(controls.edit_pyq, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2331 P(3)=sscanf(get(controls.edit_pzq, <span class="string">'String'</span>), <span class="string">'%f'</span>);
2332 
2333 
2334 <span class="comment">%update the position of the sliders as well as the edit boxes associated to</span>
2335 <span class="comment">%them</span>
2336 <a name="_sub101" href="#_subfunctions" class="code">function update_sliders()</a>
2337 
2338 <span class="keyword">global</span> robot controls
2339 
2340 error = <a href="../../arte3.1.4/lib/test_joints.html" class="code" title="function error=test_joints(robot, q)">test_joints</a>(robot, robot.q);
2341 
2342 <span class="comment">%do not update in case of any joint exceeds its range</span>
2343 <span class="keyword">if</span> error == 1
2344 <span class="keyword">return</span>;
2345 <span class="keyword">end</span>
2346 
2347 <span class="comment">%Update the sliders</span>
2348 set(controls.slider_q1, <span class="string">'Value'</span>, robot.q(1)*180/pi);
2349 set(controls.slider_q2, <span class="string">'Value'</span>, robot.q(2)*180/pi);
2350 set(controls.slider_q3, <span class="string">'Value'</span>, robot.q(3)*180/pi);
2351 set(controls.slider_q4, <span class="string">'Value'</span>, robot.q(4)*180/pi);
2352 set(controls.slider_q5, <span class="string">'Value'</span>, robot.q(5)*180/pi);
2353 set(controls.slider_q6, <span class="string">'Value'</span>, robot.q(6)*180/pi);
2354 
2355 <span class="comment">%update the edit controls associated to them</span>
2356 set(controls.edit_q1, <span class="string">'String'</span>, num2str(robot.q(1)*180/pi,3));
2357 set(controls.edit_q2, <span class="string">'String'</span>, num2str(robot.q(2)*180/pi,3));
2358 set(controls.edit_q3, <span class="string">'String'</span>, num2str(robot.q(3)*180/pi,3));
2359 set(controls.edit_q4, <span class="string">'String'</span>, num2str(robot.q(4)*180/pi,3));
2360 set(controls.edit_q5, <span class="string">'String'</span>, num2str(robot.q(5)*180/pi,3));
2361 set(controls.edit_q6, <span class="string">'String'</span>, num2str(robot.q(6)*180/pi,3));
2362 
2363 
2364 
2365 <span class="comment">%plan a lineal path interpolating linearly the joint coordinates</span>
2366 <a name="_sub102" href="#_subfunctions" class="code">function path=lineal_path_plan(q_ini, q_final)</a>
2367 
2368 <span class="keyword">global</span> robot
2369 
2370 <span class="comment">%make num_points</span>
2371 num_points = 15;
2372 
2373 path = [];
2374 
2375 <span class="keyword">for</span> i=1:robot.DOF,
2376     delta = (q_final(i)-q_ini(i))/num_points;
2377     <span class="keyword">for</span> j=1:num_points-1;
2378         path(i,j)= q_ini(i)+delta*j;
2379     <span class="keyword">end</span>
2380     path(i,num_points)=q_final(i);
2381 <span class="keyword">end</span>
2382 
2383 
2384 
2385 <span class="comment">%plan a lineal path interpolating linearly the joint coordinates</span>
2386 <a name="_sub103" href="#_subfunctions" class="code">function path=lineal_path_planXYZ(P_ini, P_final)</a>
2387 
2388 <span class="keyword">global</span> robot
2389 
2390 <span class="comment">%make num_points</span>
2391 num_points = 5;
2392 
2393 path = [];
2394 
2395 <span class="keyword">for</span> i=1:3, <span class="comment">%3, X, Y, Z</span>
2396     delta = (P_final(i)-P_ini(i))/num_points;
2397     <span class="keyword">for</span> j=1:num_points-1;
2398         path(i,j)= P_ini(i)+delta*j;
2399     <span class="keyword">end</span>
2400     path(i,num_points)=P_final(i);
2401 <span class="keyword">end</span>
2402 
2403 
2404 
2405 <span class="comment">%follow a line in global coordinates</span>
2406 <a name="_sub104" href="#_subfunctions" class="code">function follow_line(P_ini,P_final)</a>
2407 <span class="keyword">global</span> robot configuration
2408 <span class="comment">%current end effector's position/orientation</span>
2409 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
2410 
2411 current_conf = <a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);   
2412 
2413 path = <a href="#_sub103" class="code" title="subfunction path=lineal_path_planXYZ(P_ini, P_final)">lineal_path_planXYZ</a>(P_ini,P_final);
2414 
2415 <span class="keyword">for</span> i=1:size(path,2),
2416     T(1:3,4)=path(:,i);
2417     <span class="comment">%several solutions are provided</span>
2418     qinv = <a href="../../arte3.1.4/lib/kinematics/inversekinematic.html" class="code" title="function q = inversekinematic(robot, T)">inversekinematic</a>(robot, T); 
2419     <span class="comment">%choose the closest to current position</span>
2420    
2421     q=<a href="../../arte3.1.4/RAPID/functions/select_closest_joint_coordinates.html" class="code" title="function q=select_closest_joint_coordinates(robot, qinv, q_current)">select_closest_joint_coordinates</a>(robot, qinv, robot.q);
2422     
2423     robot.q = q;
2424     
2425     <span class="comment">%Test whether there are joints outside mechanical limits</span>
2426     error = <a href="../../arte3.1.4/lib/test_joints.html" class="code" title="function error=test_joints(robot, q)">test_joints</a>(robot, robot.q);
2427     
2428     <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
2429     
2430     current_conf = <a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);  
2431     
2432     <span class="keyword">if</span> error == 1
2433         disp(<span class="string">'\nAn error has occurred during the trajectory. Please check angle ranges'</span>);
2434         <span class="keyword">break</span>;
2435     <span class="keyword">end</span>
2436 <span class="keyword">end</span>
2437 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
2438 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
2439 plot3(path(1,:),path(2,:),path(3,:),<span class="string">'k'</span>, <span class="string">'LineWidth'</span>, 3);
2440 
2441 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
2442 
2443 
2444 
2445 <span class="comment">%draw the targets points on the robots figure</span>
2446 <a name="_sub105" href="#_subfunctions" class="code">function draw_target_points()</a>
2447 <span class="keyword">global</span> targets configuration controls
2448 figure(configuration.figure.robot)
2449 
2450 s=0.1; <span class="comment">%scale</span>
2451 
2452 <span class="keyword">for</span> i=1:controls.num_target_points,
2453     
2454     T = targets{i}.T;
2455     p0=T(1:3,4)';
2456     x=p0+s*T(1:3,1)';
2457     y=p0+s*T(1:3,2)';
2458     z=p0+s*T(1:3,3)';
2459     
2460     <a href="../../arte3.1.4/tools/vect_arrow.html" class="code" title="function vect_arrow(p0, p1, color, width)">vect_arrow</a>(p0,x,<span class="string">'r'</span>)
2461     <a href="../../arte3.1.4/tools/vect_arrow.html" class="code" title="function vect_arrow(p0, p1, color, width)">vect_arrow</a>(p0,y,<span class="string">'g'</span>)
2462     <a href="../../arte3.1.4/tools/vect_arrow.html" class="code" title="function vect_arrow(p0, p1, color, width)">vect_arrow</a>(p0,z,<span class="string">'b'</span>)
2463     <span class="comment">%plot vector names X_i Y_i Z_i</span>
2464     text(x(1)+0.01, x(2)+0.01, x(3)+0.01,targets{i}.name, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>, <span class="string">'HorizontalAlignment'</span>, <span class="string">'Center'</span>, <span class="string">'FontSize'</span>, 14);
2465 <span class="keyword">end</span>
2466 
2467 
2468 <a name="_sub106" href="#_subfunctions" class="code">function tp = construct_target(target_num)</a>
2469 
2470 <span class="keyword">global</span> targets
2471 
2472 T = targets{target_num}.T;
2473 Q = targets{target_num}.Q;
2474 conf = targets{target_num}.conf;
2475 
2476 tp = [[T(1,4),T(2,4),T(3,4)],[Q(1), Q(2), Q(3), Q(4)], [conf(1), conf(2), conf(3), conf(4)], [9E9,9E9,9E9,9E9,9E9,9E9]];
2477 
2478 
2479 
2480 <span class="comment">%decode a line into the different variables of a target point</span>
2481 <a name="_sub107" href="#_subfunctions" class="code">function [name, Q, T, conf]=get_targetpoint_from_string(a)</a>
2482 
2483 <span class="comment">%start decoding the line</span>
2484 [name, remain] = strtok(a,<span class="string">'='</span>);
2485 [token, remain] = strtok(remain,<span class="string">'['</span>);
2486 
2487 eval([<span class="string">'target='</span> remain]);
2488 
2489 px=target(1);
2490 py=target(2);
2491 pz=target(3);
2492 
2493 Q = target(4:7);
2494 T = <a href="../../arte3.1.4/lib/quaternion2T.html" class="code" title="function T = quaternion2T(Q, P)">quaternion2T</a>(Q, [px py pz]);
2495 
2496 conf = target(8:11);
2497 
2498 
2499 
2500 
2501 <a name="_sub108" href="#_subfunctions" class="code">function [instruction_matlab, instruction_rapid, tp1, tp2, joint_coord]=build_instruction_to_eval() </a>
2502 
2503 <span class="keyword">global</span> controls targets robot
2504 
2505 s = get(controls.popupmenu_instruction,<span class="string">'String'</span>);
2506 i = get(controls.popupmenu_instruction,<span class="string">'Value'</span>);
2507 s1=s{i};
2508 
2509 tp1=[];
2510 tp1_name=[];
2511 tp2=[];
2512 tp2_name = [];
2513 joint_coord=[];
2514 <span class="keyword">switch</span> s1
2515     <span class="keyword">case</span> {<span class="string">'MoveJ'</span>,<span class="string">'MoveL'</span>}
2516         
2517         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2518         target_num = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2519         s2=s{target_num};
2520         
2521         s = get(controls.popupmenu_speed,<span class="string">'String'</span>);
2522         i = get(controls.popupmenu_speed,<span class="string">'Value'</span>);
2523         s3=s{i};
2524         
2525         s = get(controls.popupmenu_precision,<span class="string">'String'</span>);
2526         i = get(controls.popupmenu_precision,<span class="string">'Value'</span>);
2527         s4=s{i};
2528         
2529         instruction_rapid = [s1 <span class="string">' '</span> s2 <span class="string">','</span> s3 <span class="string">','</span> s4 <span class="string">',tool0\Wobj:=wobj0;'</span>];
2530         
2531         tp1=<a href="#_sub106" class="code" title="subfunction tp = construct_target(target_num)">construct_target</a>(target_num);
2532         
2533         
2534         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2535         target_num = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2536         tp1_name=s{target_num};
2537 
2538         instruction_matlab = [<span class="string">'robot='</span> s1 <span class="string">'(robot, tp1,'</span> sprintf(<span class="string">' ''%s'' '</span>, s3) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, s4) <span class="string">', robot.tool0, robot.wobj0);'</span>];
2539         fprintf(<span class="string">'\n**********************************************\n'</span>);
2540         fprintf(<span class="string">'Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n'</span>, instruction_rapid, instruction_matlab);
2541         fprintf(<span class="string">'**********************************************\n'</span>);
2542         
2543        <span class="comment">% eval(instruction_matlab);</span>
2544         
2545      <span class="keyword">case</span> <span class="string">'MoveAbsJ'</span>
2546         
2547         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2548         target_num = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2549         s2=s{target_num};
2550         
2551         s = get(controls.popupmenu_speed,<span class="string">'String'</span>);
2552         i = get(controls.popupmenu_speed,<span class="string">'Value'</span>);
2553         s3=s{i};
2554         
2555         s = get(controls.popupmenu_precision,<span class="string">'String'</span>);
2556         i = get(controls.popupmenu_precision,<span class="string">'Value'</span>);
2557         s4=s{i};
2558         
2559         instruction_rapid = [s1 <span class="string">' '</span> s2 <span class="string">','</span> s3 <span class="string">','</span> s4 <span class="string">',tool0\Wobj:=wobj0;'</span>];
2560         
2561         
2562         joint_coord=[targets{target_num}.q' 1e9, 1e9, 1e9, 1e9, 1e9, 1e9];
2563         
2564         
2565         instruction_matlab = [<span class="string">'robot='</span> s1 <span class="string">'(robot, joint_coord,'</span> sprintf(<span class="string">' ''%s'' '</span>, s3) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, s4) <span class="string">', robot.tool0, robot.wobj0);'</span>];
2566         fprintf(<span class="string">'\n**********************************************\n'</span>);
2567         fprintf(<span class="string">'Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n'</span>, instruction_rapid, instruction_matlab);
2568         fprintf(<span class="string">'**********************************************\n'</span>);
2569         
2570        <span class="comment">% eval(instruction_matlab);</span>
2571         
2572         
2573     <span class="keyword">case</span> <span class="string">'MoveC'</span>
2574         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2575         target_num1 = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2576         s2=s{target_num1};
2577         
2578         s = get(controls.popupmenu_through_point,<span class="string">'String'</span>);
2579         target_num2 = get(controls.popupmenu_through_point,<span class="string">'Value'</span>);
2580         s3=s{target_num2};
2581         
2582         s = get(controls.popupmenu_speed,<span class="string">'String'</span>);
2583         i = get(controls.popupmenu_speed,<span class="string">'Value'</span>);
2584         vel=s{i};
2585         
2586         s = get(controls.popupmenu_precision,<span class="string">'String'</span>);
2587         i = get(controls.popupmenu_precision,<span class="string">'Value'</span>);
2588         prec=s{i};
2589         
2590         instruction_rapid = [s1 <span class="string">' '</span> s3 <span class="string">','</span> s2 <span class="string">','</span> vel <span class="string">','</span> prec  <span class="string">',tool0\Wobj:=wobj0;'</span>];
2591         
2592         tp2=<a href="#_sub106" class="code" title="subfunction tp = construct_target(target_num)">construct_target</a>(target_num1);
2593         tp1=<a href="#_sub106" class="code" title="subfunction tp = construct_target(target_num)">construct_target</a>(target_num2);<span class="comment">%the through point</span>
2594         
2595         instruction_matlab = [<span class="string">'robot='</span> s1 <span class="string">'(robot, tp1, tp2, '</span> sprintf(<span class="string">' ''%s'' '</span>, vel) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, prec) <span class="string">', robot.tool0, robot.wobj0);'</span>];
2596         fprintf(<span class="string">'\n**********************************************\n'</span>);
2597         fprintf(<span class="string">'Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n'</span>, instruction_rapid, instruction_matlab);
2598         fprintf(<span class="string">'**********************************************\n'</span>);
2599         
2600        <span class="comment">% eval(instruction_matlab);</span>
2601         
2602     <span class="keyword">otherwise</span> disp(<span class="string">'RAPID instruction not supported'</span>);
2603 <span class="keyword">end</span>
2604 
2605 
2606 
2607 <a name="_sub109" href="#_subfunctions" class="code">function [instruction_matlab, instruction_rapid]=build_instruction_to_save() </a>
2608 
2609 <span class="keyword">global</span> controls targets robot
2610 
2611 s = get(controls.popupmenu_instruction,<span class="string">'String'</span>);
2612 i = get(controls.popupmenu_instruction,<span class="string">'Value'</span>);
2613 s1=s{i};
2614 
2615 tp1=[];
2616 tp1_name=[];
2617 tp2=[];
2618 tp2_name = [];
2619 joint_coord=[];
2620 <span class="keyword">switch</span> s1
2621     <span class="keyword">case</span> {<span class="string">'MoveJ'</span>,<span class="string">'MoveL'</span>}
2622         
2623         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2624         target_num = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2625         s2=s{target_num};
2626         
2627         s = get(controls.popupmenu_speed,<span class="string">'String'</span>);
2628         i = get(controls.popupmenu_speed,<span class="string">'Value'</span>);
2629         s3=s{i};
2630         
2631         s = get(controls.popupmenu_precision,<span class="string">'String'</span>);
2632         i = get(controls.popupmenu_precision,<span class="string">'Value'</span>);
2633         s4=s{i};
2634         
2635         instruction_rapid = [s1 <span class="string">' '</span> s2 <span class="string">','</span> s3 <span class="string">','</span> s4 <span class="string">',tool0\Wobj:=wobj0;'</span>];
2636         
2637               
2638         
2639         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2640         target_num = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2641         tp_name=s{target_num};
2642 
2643         instruction_matlab = [<span class="string">'robot='</span> s1 <span class="string">'(robot,'</span> tp_name <span class="string">','</span> <span class="keyword">...</span>
2644             sprintf(<span class="string">' ''%s'' '</span>, s3) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, s4) <span class="string">', robot.tool0, robot.wobj0);'</span>];
2645         fprintf(<span class="string">'\n**********************************************\n'</span>);
2646         fprintf(<span class="string">'Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n'</span>, instruction_rapid, instruction_matlab);
2647         fprintf(<span class="string">'**********************************************\n'</span>);
2648         
2649        <span class="comment">% eval(instruction_matlab);</span>
2650         
2651      <span class="keyword">case</span> <span class="string">'MoveAbsJ'</span>
2652         
2653         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2654         target_num = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2655         s2=s{target_num};
2656         
2657         s = get(controls.popupmenu_speed,<span class="string">'String'</span>);
2658         i = get(controls.popupmenu_speed,<span class="string">'Value'</span>);
2659         s3=s{i};
2660         
2661         s = get(controls.popupmenu_precision,<span class="string">'String'</span>);
2662         i = get(controls.popupmenu_precision,<span class="string">'Value'</span>);
2663         s4=s{i};
2664         
2665         instruction_rapid = [s1 <span class="string">' '</span> s2 <span class="string">','</span> s3 <span class="string">','</span> s4 <span class="string">',tool0\Wobj:=wobj0;'</span>];
2666         
2667         
2668         <span class="comment">%joint_coord=[targets{target_num}.q' 1e9, 1e9, 1e9, 1e9, 1e9, 1e9];</span>
2669         
2670         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2671         target_num = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2672         tp_name=s{target_num};
2673         
2674         instruction_matlab = [<span class="string">'robot='</span> s1 <span class="string">'(robot,'</span> tp_name <span class="string">','</span><span class="keyword">...</span>
2675             sprintf(<span class="string">' ''%s'' '</span>, s3) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, s4) <span class="string">', robot.tool0, robot.wobj0);'</span>];
2676         fprintf(<span class="string">'\n**********************************************\n'</span>);
2677         fprintf(<span class="string">'Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n'</span>, instruction_rapid, instruction_matlab);
2678         fprintf(<span class="string">'**********************************************\n'</span>);
2679         
2680        <span class="comment">% eval(instruction_matlab);</span>
2681         
2682         
2683     <span class="keyword">case</span> <span class="string">'MoveC'</span>
2684         s = get(controls.popupmenu_target_point,<span class="string">'String'</span>);
2685         target_num1 = get(controls.popupmenu_target_point,<span class="string">'Value'</span>);
2686         s2=s{target_num1};
2687         
2688         s = get(controls.popupmenu_through_point,<span class="string">'String'</span>);
2689         target_num2 = get(controls.popupmenu_through_point,<span class="string">'Value'</span>);
2690         s3=s{target_num2};
2691         
2692         s = get(controls.popupmenu_speed,<span class="string">'String'</span>);
2693         i = get(controls.popupmenu_speed,<span class="string">'Value'</span>);
2694         vel=s{i};
2695         
2696         s = get(controls.popupmenu_precision,<span class="string">'String'</span>);
2697         i = get(controls.popupmenu_precision,<span class="string">'Value'</span>);
2698         prec=s{i};
2699         
2700         instruction_rapid = [s1 <span class="string">' '</span> s3 <span class="string">','</span> s2 <span class="string">','</span> vel <span class="string">','</span> prec  <span class="string">',tool0\Wobj:=wobj0;'</span>];
2701         
2702         
2703         
2704         instruction_matlab = [<span class="string">'robot='</span> s1 <span class="string">'(robot,'</span> s3 <span class="string">','</span> s2 <span class="string">', '</span> sprintf(<span class="string">' ''%s'' '</span>, vel) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, prec) <span class="string">', robot.tool0, robot.wobj0);'</span>];
2705         fprintf(<span class="string">'\n**********************************************\n'</span>);
2706         fprintf(<span class="string">'Evaluating instruction:\nRAPID:\n\t%s\nMatlab:\n\t%s\n'</span>, instruction_rapid, instruction_matlab);
2707         fprintf(<span class="string">'**********************************************\n'</span>);
2708         
2709        <span class="comment">% eval(instruction_matlab);</span>
2710         
2711     <span class="keyword">otherwise</span> disp(<span class="string">'RAPID instruction not supported'</span>);
2712 <span class="keyword">end</span>
2713 
2714 
2715 <span class="comment">% --- Executes on selection change in popupmenu_line_reorient.</span>
2716 <a name="_sub110" href="#_subfunctions" class="code">function popupmenu_line_reorient_Callback(hObject, eventdata, handles)</a>
2717 <span class="comment">% hObject    handle to popupmenu_line_reorient (see GCBO)</span>
2718 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2719 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2720 
2721 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu_line_reorient contents as cell array</span>
2722 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_line_reorient</span>
2723 
2724 
2725 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
2726 <a name="_sub111" href="#_subfunctions" class="code">function popupmenu_line_reorient_CreateFcn(hObject, eventdata, handles)</a>
2727 <span class="comment">% hObject    handle to popupmenu_line_reorient (see GCBO)</span>
2728 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2729 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
2730 
2731 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
2732 <span class="comment">%       See ISPC and COMPUTER.</span>
2733 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
2734     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
2735 <span class="keyword">end</span>
2736 
2737 
2738 <span class="keyword">global</span> controls
2739 controls.popupmenu_line_reorient=hObject;
2740 
2741 
2742 
2743 <span class="comment">% SHOWS CURRENT TARGET POINT IN RAPID on the command line</span>
2744 <span class="comment">% --- Executes on button press in pushbutton_show_target_point.</span>
2745 <a name="_sub112" href="#_subfunctions" class="code">function pushbutton_show_target_point_Callback(hObject, eventdata, handles)</a>
2746 <span class="comment">% hObject    handle to pushbutton_show_target_point (see GCBO)</span>
2747 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2748 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2749 
2750 <span class="keyword">global</span> controls targets robot
2751 
2752 T = <a href="../../arte3.1.4/lib/kinematics/directkinematic.html" class="code" title="function T = directkinematic(robot, q)">directkinematic</a>(robot, robot.q);
2753 
2754 <span class="comment">%convert to quaternion</span>
2755 Q = <a href="../../arte3.1.4/lib/T2quaternion.html" class="code" title="function Q = T2quaternion(T)">T2quaternion</a>(T);
2756 Q=real(Q);
2757 conf = <a href="../../arte3.1.4/RAPID/functions/compute_configuration.html" class="code" title="function conf=compute_configuration(robot, q)">compute_configuration</a>(robot, robot.q);
2758 
2759 tp = [[T(1,4),T(2,4),T(3,4)],[Q(1), Q(2), Q(3), Q(4)], [conf(1), conf(2), conf(3), conf(4)], [9E9,9E9,9E9,9E9,9E9,9E9]];
2760 fprintf(<span class="string">'\n\ntp:=[[%f,%f,%f],[%f,%f,%f,%f],[%f,%f,%f,%f],[9E9,9E9,9E9,9E9,9E9,9E9]];\n\n'</span>,tp(1),tp(2),tp(3),tp(4),tp(5),tp(6),tp(7),tp(8),tp(9),tp(10),tp(11));
2761 
2762 
2763 
2764 <span class="comment">% --- Executes on key press with focus on pushbutton_show_target_point and none of its controls.</span>
2765 <span class="comment">% SHOWS THE CURRENT TP WHERE THE ROBOT IS SITUATED</span>
2766 <a name="_sub113" href="#_subfunctions" class="code">function pushbutton_show_target_point_KeyPressFcn(hObject, eventdata, handles)</a>
2767 <span class="comment">% hObject    handle to pushbutton_show_target_point (see GCBO)</span>
2768 <span class="comment">% eventdata  structure with the following fields (see UICONTROL)</span>
2769 <span class="comment">%    Key: name of the key that was pressed, in lower case</span>
2770 <span class="comment">%    Character: character interpretation of the key(s) that was pressed</span>
2771 <span class="comment">%    Modifier: name(s) of the modifier key(s) (i.e., control, shift) pressed</span>
2772 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2773 
2774 
2775 
2776 
2777 
2778 <span class="comment">% --- Executes on selection change in popupmenu_resolution.</span>
2779 <a name="_sub114" href="#_subfunctions" class="code">function popupmenu_resolution_Callback(hObject, eventdata, handles)</a>
2780 <span class="comment">% hObject    handle to popupmenu_resolution (see GCBO)</span>
2781 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2782 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2783 
2784 <span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu_resolution contents as cell array</span>
2785 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_resolution</span>
2786 
2787 
2788 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
2789 <a name="_sub115" href="#_subfunctions" class="code">function popupmenu_resolution_CreateFcn(hObject, eventdata, handles)</a>
2790 <span class="comment">% hObject    handle to popupmenu_resolution (see GCBO)</span>
2791 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2792 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
2793 
2794 <span class="keyword">global</span> controls
2795 controls.popupmenu_resolution=hObject;
2796 
2797 
2798 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
2799 <span class="comment">%       See ISPC and COMPUTER.</span>
2800 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
2801     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
2802 <span class="keyword">end</span>
2803 
2804 
2805 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2806 <span class="comment">% RESETS THE ROBOTS CURRENT JOINTS TO 0</span>
2807 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2808 <span class="comment">% --- Executes on button press in pushbutton_reset_all.</span>
2809 <a name="_sub116" href="#_subfunctions" class="code">function pushbutton_reset_all_Callback(hObject, eventdata, handles)</a>
2810 <span class="comment">% hObject    handle to pushbutton_reset_all (see GCBO)</span>
2811 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2812 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2813 
2814 <span class="keyword">global</span> configuration robot controls
2815 
2816 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
2817 figure(configuration.figure.robot);
2818 
2819 
2820 <a href="../../arte3.1.4/tools/drawrobot3d.html" class="code" title="function drawrobot3d(robot, q, noclear)">drawrobot3d</a>(robot, robot.q);
2821 
2822 final_joints = zeros(1,robot.DOF);
2823 <span class="comment">%Use MoveAbsJ to move to zero coordinates</span>
2824 command =[<span class="string">'[robot] = MoveAbsJ(robot,final_joints,'</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'vmax'</span>) <span class="string">','</span> sprintf(<span class="string">' ''%s'' '</span>, <span class="string">'fine'</span>) <span class="string">',robot.tool0, robot.wobj0);'</span>];
2825 eval(command);
2826 <a href="#_sub99" class="code" title="subfunction update_T_Q()">update_T_Q</a>();
2827 <a href="#_sub105" class="code" title="subfunction draw_target_points()">draw_target_points</a>();
2828 <a href="#_sub101" class="code" title="subfunction update_sliders()">update_sliders</a>();
2829 
2830 
2831 <span class="comment">% --- Executes on key press with focus on pushbutton_save_target_point and none of its controls.</span>
2832 <a name="_sub117" href="#_subfunctions" class="code">function pushbutton_save_target_point_KeyPressFcn(hObject, eventdata, handles)</a>
2833 <span class="comment">% hObject    handle to pushbutton_save_target_point (see GCBO)</span>
2834 <span class="comment">% eventdata  structure with the following fields (see UICONTROL)</span>
2835 <span class="comment">%    Key: name of the key that was pressed, in lower case</span>
2836 <span class="comment">%    Character: character interpretation of the key(s) that was pressed</span>
2837 <span class="comment">%    Modifier: name(s) of the modifier key(s) (i.e., control, shift) pressed</span>
2838 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2839 
2840 
2841 
2842 
2843 
2844 
2845 
2846 
2847 <a name="_sub118" href="#_subfunctions" class="code">function index=find_closest(q,qi)</a>
2848 
2849 qq=[];
2850 <span class="keyword">for</span> i=1:size(q,2),
2851     qq=[qq qi];
2852 <span class="keyword">end</span>
2853 
2854 a=sum((q-qq).^2);
2855 
2856 index = min(a);</pre></div>
<hr><address>Generated on Wed 29-May-2013 19:30:18 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>